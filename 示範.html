<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>程式碼： (1)</title>
  <style>
    /* cspell:disable-file */
    /* webkit printing magic: print all background colors */
    html {
      -webkit-print-color-adjust: exact;
    }

    * {
      box-sizing: border-box;
      -webkit-print-color-adjust: exact;
    }

    html,
    body {
      margin: 0;
      padding: 0;
    }

    @media only screen {
      body {
        margin: 2em auto;
        max-width: 900px;
        color: rgb(55, 53, 47);
      }
    }

    body {
      line-height: 1.5;
      white-space: pre-wrap;
    }

    a,
    a.visited {
      color: inherit;
      text-decoration: underline;
    }

    .pdf-relative-link-path {
      font-size: 80%;
      color: #444;
    }

    h1,
    h2,
    h3 {
      letter-spacing: -0.01em;
      line-height: 1.2;
      font-weight: 600;
      margin-bottom: 0;
    }

    /* Override strong tags inside headings to maintain consistent weight */
    h1 strong,
    h2 strong,
    h3 strong {
      font-weight: 600;
    }

    .page-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin-top: 0;
      margin-bottom: 0.75em;
    }

    h1 {
      font-size: 1.875rem;
      margin-top: 1.875rem;
    }

    h2 {
      font-size: 1.5rem;
      margin-top: 1.5rem;
    }

    h3 {
      font-size: 1.25rem;
      margin-top: 1.25rem;
    }

    .source {
      border: 1px solid #ddd;
      border-radius: 3px;
      padding: 1.5em;
      word-break: break-all;
    }

    .callout {
      border-radius: 10px;
      padding: 1rem;
    }

    figure {
      margin: 1.25em 0;
      page-break-inside: avoid;
    }

    figcaption {
      opacity: 0.5;
      font-size: 85%;
      margin-top: 0.5em;
    }

    mark {
      background-color: transparent;
    }

    .indented {
      padding-left: 1.5em;
    }

    hr {
      background: transparent;
      display: block;
      width: 100%;
      height: 1px;
      visibility: visible;
      border: none;
      border-bottom: 1px solid rgba(55, 53, 47, 0.09);
    }

    img {
      max-width: 100%;
    }

    @media only print {
      img {
        max-height: 100vh;
        object-fit: contain;
      }
    }

    @page {
      margin: 1in;
    }

    .collection-content {
      font-size: 0.875rem;
    }

    .collection-content td {
      white-space: pre-wrap;
      word-break: break-word;
    }

    .column-list {
      display: flex;
      justify-content: space-between;
    }

    .column {
      padding: 0 1em;
    }

    .column:first-child {
      padding-left: 0;
    }

    .column:last-child {
      padding-right: 0;
    }

    .table_of_contents-item {
      display: block;
      font-size: 0.875rem;
      line-height: 1.3;
      padding: 0.125rem;
    }

    .table_of_contents-indent-1 {
      margin-left: 1.5rem;
    }

    .table_of_contents-indent-2 {
      margin-left: 3rem;
    }

    .table_of_contents-indent-3 {
      margin-left: 4.5rem;
    }

    .table_of_contents-link {
      text-decoration: none;
      opacity: 0.7;
      border-bottom: 1px solid rgba(55, 53, 47, 0.18);
    }

    table,
    th,
    td {
      border: 1px solid rgba(55, 53, 47, 0.09);
      border-collapse: collapse;
    }

    table {
      border-left: none;
      border-right: none;
    }

    th,
    td {
      font-weight: normal;
      padding: 0.25em 0.5em;
      line-height: 1.5;
      min-height: 1.5em;
      text-align: left;
    }

    th {
      color: rgba(55, 53, 47, 0.6);
    }

    ol,
    ul {
      margin: 0;
      margin-block-start: 0.6em;
      margin-block-end: 0.6em;
    }

    li>ol:first-child,
    li>ul:first-child {
      margin-block-start: 0.6em;
    }

    ul>li {
      list-style: disc;
    }

    ul.to-do-list {
      padding-inline-start: 0;
    }

    ul.to-do-list>li {
      list-style: none;
    }

    .to-do-children-checked {
      text-decoration: line-through;
      opacity: 0.375;
    }

    ul.toggle>li {
      list-style: none;
    }

    ul {
      padding-inline-start: 1.7em;
    }

    ul>li {
      padding-left: 0.1em;
    }

    ol {
      padding-inline-start: 1.6em;
    }

    ol>li {
      padding-left: 0.2em;
    }

    .mono ol {
      padding-inline-start: 2em;
    }

    .mono ol>li {
      text-indent: -0.4em;
    }

    .toggle {
      padding-inline-start: 0em;
      list-style-type: none;
    }

    /* Indent toggle children */
    .toggle>li>details {
      padding-left: 1.7em;
    }

    .toggle>li>details>summary {
      margin-left: -1.1em;
    }

    .selected-value {
      display: inline-block;
      padding: 0 0.5em;
      background: rgba(206, 205, 202, 0.5);
      border-radius: 3px;
      margin-right: 0.5em;
      margin-top: 0.3em;
      margin-bottom: 0.3em;
      white-space: nowrap;
    }

    .collection-title {
      display: inline-block;
      margin-right: 1em;
    }

    .page-description {
      margin-bottom: 2em;
    }

    .simple-table {
      margin-top: 1em;
      font-size: 0.875rem;
      empty-cells: show;
    }

    .simple-table td {
      height: 29px;
      min-width: 120px;
    }

    .simple-table th {
      height: 29px;
      min-width: 120px;
    }

    .simple-table-header-color {
      background: rgb(247, 246, 243);
      color: black;
    }

    .simple-table-header {
      font-weight: 500;
    }

    time {
      opacity: 0.5;
    }

    .icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      max-width: 1.2em;
      max-height: 1.2em;
      text-decoration: none;
      vertical-align: text-bottom;
      margin-right: 0.5em;
    }

    img.icon {
      border-radius: 3px;
    }

    .callout img.notion-static-icon {
      width: 1em;
      height: 1em;
    }

    .callout p {
      margin: 0;
    }

    .callout h1,
    .callout h2,
    .callout h3 {
      margin: 0 0 0.6rem;
    }

    .user-icon {
      width: 1.5em;
      height: 1.5em;
      border-radius: 100%;
      margin-right: 0.5rem;
    }

    .user-icon-inner {
      font-size: 0.8em;
    }

    .text-icon {
      border: 1px solid #000;
      text-align: center;
    }

    .page-cover-image {
      display: block;
      object-fit: cover;
      width: 100%;
      max-height: 30vh;
    }

    .page-header-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .page-header-icon-with-cover {
      margin-top: -0.72em;
      margin-left: 0.07em;
    }

    .page-header-icon img {
      border-radius: 3px;
    }

    .link-to-page {
      margin: 1em 0;
      padding: 0;
      border: none;
      font-weight: 500;
    }

    p>.user {
      opacity: 0.5;
    }

    td>.user,
    td>time {
      white-space: nowrap;
    }

    input[type="checkbox"] {
      transform: scale(1.5);
      margin-right: 0.6em;
      vertical-align: middle;
    }

    p {
      margin-top: 0.5em;
      margin-bottom: 0.5em;
    }

    .image {
      border: none;
      margin: 1.5em 0;
      padding: 0;
      border-radius: 0;
      text-align: center;
    }

    .code,
    code {
      background: rgba(135, 131, 120, 0.15);
      border-radius: 3px;
      padding: 0.2em 0.4em;
      border-radius: 3px;
      font-size: 85%;
      tab-size: 2;
    }

    code {
      color: #eb5757;
    }

    .code {
      padding: 1.5em 1em;
    }

    .code-wrap {
      white-space: pre-wrap;
      word-break: break-all;
    }

    .code>code {
      background: none;
      padding: 0;
      font-size: 100%;
      color: inherit;
    }

    blockquote {
      font-size: 1em;
      margin: 1em 0;
      padding-left: 1em;
      border-left: 3px solid rgb(55, 53, 47);
    }

    blockquote.quote-large {
      font-size: 1.25em;
    }

    .bookmark {
      text-decoration: none;
      max-height: 8em;
      padding: 0;
      display: flex;
      width: 100%;
      align-items: stretch;
    }

    .bookmark-title {
      font-size: 0.85em;
      overflow: hidden;
      text-overflow: ellipsis;
      height: 1.75em;
      white-space: nowrap;
    }

    .bookmark-text {
      display: flex;
      flex-direction: column;
    }

    .bookmark-info {
      flex: 4 1 180px;
      padding: 12px 14px 14px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .bookmark-image {
      width: 33%;
      flex: 1 1 180px;
      display: block;
      position: relative;
      object-fit: cover;
      border-radius: 1px;
    }

    .bookmark-description {
      color: rgba(55, 53, 47, 0.6);
      font-size: 0.75em;
      overflow: hidden;
      max-height: 4.5em;
      word-break: break-word;
    }

    .bookmark-href {
      font-size: 0.75em;
      margin-top: 0.25em;
    }

    .sans {
      font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
    }

    .code {
      font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace;
    }

    .serif {
      font-family: Lyon-Text, Georgia, ui-serif, serif;
    }

    .mono {
      font-family: iawriter-mono, Nitti, Menlo, Courier, monospace;
    }

    .pdf .sans {
      font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP';
    }

    .pdf:lang(zh-CN) .sans {
      font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC';
    }

    .pdf:lang(zh-TW) .sans {
      font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC';
    }

    .pdf:lang(ko-KR) .sans {
      font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR';
    }

    .pdf .code {
      font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP';
    }

    .pdf:lang(zh-CN) .code {
      font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC';
    }

    .pdf:lang(zh-TW) .code {
      font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC';
    }

    .pdf:lang(ko-KR) .code {
      font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR';
    }

    .pdf .serif {
      font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP';
    }

    .pdf:lang(zh-CN) .serif {
      font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC';
    }

    .pdf:lang(zh-TW) .serif {
      font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC';
    }

    .pdf:lang(ko-KR) .serif {
      font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR';
    }

    .pdf .mono {
      font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP';
    }

    .pdf:lang(zh-CN) .mono {
      font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC';
    }

    .pdf:lang(zh-TW) .mono {
      font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC';
    }

    .pdf:lang(ko-KR) .mono {
      font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR';
    }

    .highlight-default {
      color: rgba(44, 44, 43, 1);
    }

    .highlight-gray {
      color: rgba(125, 122, 117, 1);
      fill: rgba(125, 122, 117, 1);
    }

    .highlight-brown {
      color: rgba(159, 118, 90, 1);
      fill: rgba(159, 118, 90, 1);
    }

    .highlight-orange {
      color: rgba(210, 123, 45, 1);
      fill: rgba(210, 123, 45, 1);
    }

    .highlight-yellow {
      color: rgba(203, 148, 52, 1);
      fill: rgba(203, 148, 52, 1);
    }

    .highlight-teal {
      color: rgba(80, 148, 110, 1);
      fill: rgba(80, 148, 110, 1);
    }

    .highlight-blue {
      color: rgba(56, 125, 201, 1);
      fill: rgba(56, 125, 201, 1);
    }

    .highlight-purple {
      color: rgba(154, 107, 180, 1);
      fill: rgba(154, 107, 180, 1);
    }

    .highlight-pink {
      color: rgba(193, 76, 138, 1);
      fill: rgba(193, 76, 138, 1);
    }

    .highlight-red {
      color: rgba(207, 81, 72, 1);
      fill: rgba(207, 81, 72, 1);
    }

    .highlight-default_background {
      color: rgba(44, 44, 43, 1);
    }

    .highlight-gray_background {
      background: rgba(42, 28, 0, 0.07);
    }

    .highlight-brown_background {
      background: rgba(139, 46, 0, 0.086);
    }

    .highlight-orange_background {
      background: rgba(224, 101, 1, 0.129);
    }

    .highlight-yellow_background {
      background: rgba(211, 168, 0, 0.137);
    }

    .highlight-teal_background {
      background: rgba(0, 100, 45, 0.09);
    }

    .highlight-blue_background {
      background: rgba(0, 124, 215, 0.094);
    }

    .highlight-purple_background {
      background: rgba(102, 0, 178, 0.078);
    }

    .highlight-pink_background {
      background: rgba(197, 0, 93, 0.086);
    }

    .highlight-red_background {
      background: rgba(223, 22, 0, 0.094);
    }

    .block-color-default {
      color: inherit;
      fill: inherit;
    }

    .block-color-gray {
      color: rgba(125, 122, 117, 1);
      fill: rgba(125, 122, 117, 1);
    }

    .block-color-brown {
      color: rgba(159, 118, 90, 1);
      fill: rgba(159, 118, 90, 1);
    }

    .block-color-orange {
      color: rgba(210, 123, 45, 1);
      fill: rgba(210, 123, 45, 1);
    }

    .block-color-yellow {
      color: rgba(203, 148, 52, 1);
      fill: rgba(203, 148, 52, 1);
    }

    .block-color-teal {
      color: rgba(80, 148, 110, 1);
      fill: rgba(80, 148, 110, 1);
    }

    .block-color-blue {
      color: rgba(56, 125, 201, 1);
      fill: rgba(56, 125, 201, 1);
    }

    .block-color-purple {
      color: rgba(154, 107, 180, 1);
      fill: rgba(154, 107, 180, 1);
    }

    .block-color-pink {
      color: rgba(193, 76, 138, 1);
      fill: rgba(193, 76, 138, 1);
    }

    .block-color-red {
      color: rgba(207, 81, 72, 1);
      fill: rgba(207, 81, 72, 1);
    }

    .block-color-default_background {
      color: inherit;
      fill: inherit;
    }

    .block-color-gray_background {
      background: rgba(240, 239, 237, 1);
    }

    .block-color-brown_background {
      background: rgba(245, 237, 233, 1);
    }

    .block-color-orange_background {
      background: rgba(251, 235, 222, 1);
    }

    .block-color-yellow_background {
      background: rgba(249, 243, 220, 1);
    }

    .block-color-teal_background {
      background: rgba(232, 241, 236, 1);
    }

    .block-color-blue_background {
      background: rgba(229, 242, 252, 1);
    }

    .block-color-purple_background {
      background: rgba(243, 235, 249, 1);
    }

    .block-color-pink_background {
      background: rgba(250, 233, 241, 1);
    }

    .block-color-red_background {
      background: rgba(252, 233, 231, 1);
    }

    .select-value-color-default {
      background-color: rgba(42, 28, 0, 0.07);
    }

    .select-value-color-gray {
      background-color: rgba(28, 19, 1, 0.11);
    }

    .select-value-color-brown {
      background-color: rgba(127, 51, 0, 0.156);
    }

    .select-value-color-orange {
      background-color: rgba(196, 88, 0, 0.203);
    }

    .select-value-color-yellow {
      background-color: rgba(209, 156, 0, 0.282);
    }

    .select-value-color-green {
      background-color: rgba(0, 96, 38, 0.156);
    }

    .select-value-color-blue {
      background-color: rgba(0, 118, 217, 0.203);
    }

    .select-value-color-purple {
      background-color: rgba(92, 0, 163, 0.141);
    }

    .select-value-color-pink {
      background-color: rgba(183, 0, 78, 0.152);
    }

    .select-value-color-red {
      background-color: rgba(206, 24, 0, 0.164);
    }

    .checkbox {
      display: inline-flex;
      vertical-align: text-bottom;
      width: 16;
      height: 16;
      background-size: 16px;
      margin-left: 2px;
      margin-right: 5px;
    }

    .checkbox-on {
      background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
    }

    .checkbox-off {
      background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
    }
  </style>
</head>

<body>
  <article id="2d3a9421-272e-8070-af89-f633a7314af6" class="page sans">
    <header>
      <h1 class="page-title" dir="auto">程式碼： (1)</h1>
      <p class="page-description" dir="auto"></p>
    </header>
    <div class="page-body">
      <div style="display:contents" dir="auto">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"
          integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg=="
          crossorigin="anonymous" referrerPolicy="no-referrer"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css"
          integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ=="
          crossorigin="anonymous" referrerPolicy="no-referrer" />
        <pre id="2d3a9421-272e-8016-8c98-cc322d628b74" class="code code-wrap"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all">import React, { useState, useEffect, useRef } from &#x27;react&#x27;;
import { 
  Heart, MessageCircle, Share2, Star, AlertCircle, ShoppingCart, 
  User, CheckCircle, MapPin, ThumbsUp, Send, Search, Bell, 
  BookOpen, Filter, ArrowRight, Menu, Home, Lock, Mail, ChevronDown, Camera,
  Plus, Image as ImageIcon, Trash2, Clock, DollarSign, FileText, AlertTriangle, X, Gift, Repeat, LogOut, LayoutGrid, Tag, Info, HelpCircle, ShieldCheck, Smile, Flame, Book, Sparkles, HandMetal, Calendar, Zap, Coins, Settings, ChevronLeft, Palette, Store, ChevronRight, RotateCcw, ShoppingBag
} from &#x27;lucide-react&#x27;;

// --- 全局樣式設定 ---
const fontStyle = { fontFamily: &quot;&#x27;Noto Sans TC&#x27;, &#x27;PMingLiU&#x27;, sans-serif&quot; };

// --- 奶茶色系色碼定義 ---
const COLORS = {
  whiteBucks: &#x27;#E8E3DF&#x27;,
  cloudSand: &#x27;#E6DBC6&#x27;,
  fossilGray: &#x27;#C9C3B6&#x27;,
  brushwood: &#x27;#9E9081&#x27;,
  chocolateBubble: &#x27;#A58976&#x27;,
  brownWindmill: &#x27;#756256&#x27;,
  bgLight: &#x27;#F9F7F5&#x27;,
};

// --- 資料選項常數 ---
const PUBLISHERS = [&quot;龍騰&quot;, &quot;翰林&quot;, &quot;南一&quot;, &quot;三民&quot;, &quot;全華&quot;, &quot;泰宇&quot;, &quot;其他/補習班&quot;];
const SUBJECTS = [&quot;國文&quot;, &quot;英文&quot;, &quot;數學&quot;, &quot;物理&quot;, &quot;化學&quot;, &quot;生物&quot;, &quot;地科&quot;, &quot;歷史&quot;, &quot;地理&quot;, &quot;公民&quot;, &quot;理化&quot;];
const GRADES = [&quot;國一&quot;, &quot;國二&quot;, &quot;國三&quot;, &quot;高一&quot;, &quot;高二&quot;, &quot;高三&quot;]; 
const CATEGORIES = [
  { id: &#x27;all&#x27;, name: &#x27;全部&#x27; },
  { id: &#x27;chi&#x27;, name: &#x27;國文&#x27; },
  { id: &#x27;eng&#x27;, name: &#x27;英文&#x27; },
  { id: &#x27;math&#x27;, name: &#x27;數學&#x27; },
  { id: &#x27;sci&#x27;, name: &#x27;自然&#x27; },
  { id: &#x27;soc&#x27;, name: &#x27;社會&#x27; },
  { id: &#x27;exam&#x27;, name: &#x27;學測&#x27; }, 
  { id: &#x27;cap&#x27;, name: &#x27;會考&#x27; }, 
];

// --- [修改] 頭像列表資料 ---
const AVATAR_LIST = [
  // [類別 1] 預設
  { 
    id: &#x27;default&#x27;, 
    name: &#x27;初始初心者&#x27;, 
    price: 0, 
    src: &#x27;https://i.postimg.cc/9fW28Bc0/niu.jpg&#x27; 
  },
  
  // [類別 2] 100 代幣限定 (ID 以 special 開頭)
  { 
    id: &#x27;special1&#x27;, 
    name: &#x27;限定兔兔&#x27;, 
    price: 100, 
    src: &#x27;https://i.postimg.cc/zyP43KbN/tu-zi.jpg&#x27; 
  },
  { 
    id: &#x27;special2&#x27;, 
    name: &#x27;限定小豬&#x27;, 
    price: 100, 
    src: &#x27;https://i.postimg.cc/pd2vGBP9/zhu.jpg&#x27; 
  },
  { 
    id: &#x27;special3&#x27;, 
    name: &#x27;限定狗狗&#x27;, 
    price: 100, 
    src: &#x27;https://i.postimg.cc/wB6zfk97/gou.jpg&#x27; 
  },
  { 
    id: &#x27;special4&#x27;, 
    name: &#x27;限定小牛&#x27;, 
    price: 100, 
    src: &#x27;https://i.postimg.cc/qNvyYNG3/EE1D91FC-D76E-4FBA-A85F-33F8D82EAFEB.jpg&#x27; 
  },
  { 
    id: &#x27;special5&#x27;, 
    name: &#x27;限定小羊&#x27;, 
    price: 100, 
    src: &#x27;https://i.postimg.cc/VkjgJMr4/84AD5380-E492-4603-B7C7-4BD68372B94A.jpg&#x27; 
  },

  // [類別 3] 經典系列 (價格已統一修改為 100)
  { id: &#x27;cat&#x27;, name: &#x27;熬夜貓貓&#x27;, price: 100, src: &#x27;https://api.dicebear.com/7.x/miniavs/svg?seed=cat&amp;backgroundColor=FFD700&#x27; },
  { id: &#x27;glasses&#x27;, name: &#x27;考滿分&#x27;, price: 100, src: &#x27;https://api.dicebear.com/7.x/miniavs/svg?seed=glasses&amp;backgroundColor=4ADE80&#x27; },
  { id: &#x27;cool&#x27;, name: &#x27;校園酷蓋&#x27;, price: 100, src: &#x27;https://api.dicebear.com/7.x/miniavs/svg?seed=cool&amp;backgroundColor=A58976&#x27; },
  { id: &#x27;artist&#x27;, name: &#x27;文藝青年&#x27;, price: 100, src: &#x27;https://api.dicebear.com/7.x/miniavs/svg?seed=artist&amp;backgroundColor=FFB6C1&#x27; },
  { id: &#x27;robot&#x27;, name: &#x27;理科腦&#x27;, price: 100, src: &#x27;https://api.dicebear.com/7.x/bottts/svg?seed=robot&amp;backgroundColor=E0E0E0&#x27; },
];

// --- 模擬資料 ---
const RECENT_BOOKS = [
  {
    id: 1,
    title: &quot;完全捷進寫作詞彙 (2025 全新增訂版)&quot;,
    author: &quot;黃淑貞&quot;,
    publisher: &quot;龍騰&quot;,
    subject: &quot;國文&quot;,
    grade: &quot;高一&quot;,
    originalPrice: 450,
    price: 270,
    type: &#x27;sell&#x27;,
    productType: &#x27;book&#x27;,
    cover: &quot;https://im1.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/086/56/0010865620.jpg&amp;v=5f2a7a5dk&amp;w=348&amp;h=348&quot;,
    description: &quot;這本超好用！作文救星，裡面有我很認真的筆記，字很漂亮喔。&quot;,
    seller: { name: &quot;陳小明&quot;, score: 4.8 },
    conditionLevel: &quot;九成新&quot;,
    location: &quot;圖書館&quot;
  },
  {
    id: 5,
    title: &quot;台大醫科生 - 化學全範圍筆記&quot;,
    author: &quot;學霸本人&quot;,
    publisher: &quot;其他&quot;,
    subject: &quot;化學&quot;,
    grade: &quot;高三&quot;,
    type: &#x27;sell&#x27;,
    productType: &#x27;note&#x27;, 
    originalPrice: 1000,
    price: 600,
    cover: &quot;https://im1.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/095/38/0010953846.jpg&amp;v=5f2a7a5dk&amp;w=348&amp;h=348&quot;,
    description: &quot;全彩印刷，重點整理，考前衝刺必備。&quot;,
    seller: { name: &quot;柯同學&quot;, score: 5.0 },
    conditionLevel: &quot;全新&quot;,
    location: &quot;圖書館&quot;
  },
  {
    id: 2,
    title: &quot;高中數學(三)課本&quot;,
    author: &quot;教育部審定&quot;,
    publisher: &quot;翰林&quot;,
    subject: &quot;數學&quot;,
    grade: &quot;高二&quot;,
    type: &#x27;exchange&#x27;,
    productType: &#x27;book&#x27;,
    originalPrice: 300,
    price: 0,
    cover: &quot;https://im1.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/086/67/0010866753.jpg&amp;v=5f3b3b3b&amp;w=348&amp;h=348&quot;,
    description: &quot;我想換高二下的英文雜誌，任何月份都可以。&quot;,
    seller: { name: &quot;林同學&quot;, score: 4.5 },
    conditionLevel: &quot;五成新&quot;,
    location: &quot;福利社&quot;
  },
  {
    id: 3,
    title: &quot;空中英語教室 9月號&quot;,
    author: &quot;Studio Classroom&quot;,
    publisher: &quot;其他&quot;,
    subject: &quot;英文&quot;,
    grade: &quot;高一&quot;,
    type: &#x27;gift&#x27;,
    productType: &#x27;book&#x27;,
    originalPrice: 220,
    price: 0,
    cover: &quot;https://im1.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/096/56/0010965620.jpg&amp;v=5f2a7a5dk&amp;w=348&amp;h=348&quot;,
    description: &quot;看完就送給有需要的人，直接在校門口面交。&quot;,
    seller: { name: &quot;王小美&quot;, score: 5.0 },
    conditionLevel: &quot;全新&quot;,
    location: &quot;校門口&quot;
  },
  {
    id: 4,
    title: &quot;物理講義 (上冊)&quot;,
    author: &quot;張鎮麟&quot;,
    publisher: &quot;其他&quot;,
    subject: &quot;物理&quot;,
    grade: &quot;高三&quot;,
    type: &#x27;sell&#x27;,
    productType: &#x27;book&#x27;,
    originalPrice: 500,
    price: 350,
    cover: &quot;https://im2.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/093/12/0010931234.jpg&amp;v=5f2a7a5dk&amp;w=348&amp;h=348&quot;,
    description: &quot;補習班講義，觀念講得很清楚。&quot;,
    seller: { name: &quot;張偉&quot;, score: 4.2 },
    conditionLevel: &quot;九成新&quot;,
    location: &quot;體育館&quot;
  },
  {
    id: 6,
    title: &quot;學測英文作文萬用句型整理&quot;,
    author: &quot;英文小老師&quot;,
    publisher: &quot;其他&quot;,
    subject: &quot;英文&quot;,
    grade: &quot;高三&quot;,
    type: &#x27;sell&#x27;,
    productType: &#x27;note&#x27;,
    originalPrice: 300,
    price: 150,
    cover: &quot;https://im2.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/094/72/0010947231.jpg&amp;v=5f2a7a5dk&amp;w=348&amp;h=348&quot;,
    description: &quot;自製筆記，背完這幾句作文基本分就有了。&quot;,
    seller: { name: &quot;Vivian&quot;, score: 4.9 },
    conditionLevel: &quot;九成新&quot;,
    location: &quot;校門口&quot;
  },
  {
    id: 7,
    title: &quot;國中會考聖經：自然科總複習&quot;,
    author: &quot;王大明&quot;,
    publisher: &quot;翰林&quot;,
    subject: &quot;理化&quot;,
    grade: &quot;國三&quot;,
    type: &#x27;sell&#x27;,
    productType: &#x27;book&#x27;,
    originalPrice: 380,
    price: 150,
    cover: &quot;https://im1.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/087/34/0010873421.jpg&amp;v=5f2a7a5dk&amp;w=348&amp;h=348&quot;,
    description: &quot;針對會考趨勢整理，裡面有螢光筆劃記，不介意再下單。&quot;,
    seller: { name: &quot;小剛&quot;, score: 4.0 },
    conditionLevel: &quot;七成新&quot;,
    location: &quot;活動中心&quot;
  }
];

const INITIAL_WISHES = [
  { id: 1, content: &quot;求購 高一 龍騰 生物課本！急！&quot;, user: &quot;小高一&quot;, time: &quot;10分鐘前&quot; },
  { id: 2, content: &quot;有沒有人有不要的學測歷屆試題？&quot;, user: &quot;準考生&quot;, time: &quot;1小時前&quot; },
  { id: 3, content: &quot;想找 搶救國文大作戰，舊版也可以&quot;, user: &quot;國文苦手&quot;, time: &quot;3小時前&quot; },
];

const INITIAL_MY_LISTINGS = [
  { id: 101, title: &quot;龍騰高一英文課本 Book 1&quot;, price: 150, type: &#x27;sell&#x27;, status: &#x27;active&#x27;, date: &#x27;2025-02-28&#x27;, views: 45, cover: &quot;https://im1.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/096/56/0010965620.jpg&amp;v=5f2a7a5dk&amp;w=348&amp;h=348&quot; }
];

const INITIAL_NOTIFICATIONS = [
  { id: 1, type: &#x27;comment&#x27;, user: &#x27;王小明&#x27;, avatar: null, content: &#x27;請問這本書還有嗎？&#x27;, time: &#x27;5分鐘前&#x27;, isRead: false },
  { id: 2, type: &#x27;system&#x27;, content: &#x27;您的書籍已經上架超過 30 天未售出。&#x27;, time: &#x27;2小時前&#x27;, isRead: false },
  { id: 3, type: &#x27;system&#x27;, content: &#x27;歡迎來到 UniBooks！&#x27;, time: &#x27;1天前&#x27;, isRead: true } 
];

const MOCK_USER_PROFILE = { name: &quot;李同學&quot;, email: &quot;s112501@school.edu.tw&quot;, avatar: null, grade: &quot;高二&quot;, class: &quot;誠&quot;, isVerified: true };
const CONDITION_LEVELS = [&quot;一成新&quot;, &quot;三成新&quot;, &quot;五成新&quot;, &quot;九成新&quot;, &quot;全新&quot;];

// --- Helper Functions ---
const PriceDisplay = ({ type, price, originalPrice, large = false }) =&gt; {
  if (type === &#x27;exchange&#x27;) return &lt;div className={`flex items-center gap-1 font-bold ${large ? &#x27;text-2xl&#x27; : &#x27;text-sm&#x27;}`} style={{ color: COLORS.brushwood }}&gt;&lt;Repeat size={large ? 20 : 14} /&gt;&lt;span&gt;想交換&lt;/span&gt;&lt;/div&gt;;
  if (type === &#x27;gift&#x27;) return &lt;div className={`flex items-center gap-1 font-bold ${large ? &#x27;text-2xl&#x27; : &#x27;text-sm&#x27;}`} style={{ color: COLORS.chocolateBubble }}&gt;&lt;Gift size={large ? 20 : 14} /&gt;&lt;span&gt;贈送&lt;/span&gt;&lt;/div&gt;;
  return &lt;div className=&quot;flex flex-col&quot;&gt;&lt;div className={`font-bold ${large ? &#x27;text-3xl&#x27; : &#x27;text-lg&#x27;}`} style={{ color: COLORS.brownWindmill }}&gt;NT$ {price}&lt;/div&gt;{originalPrice &amp;&amp; &lt;span className=&quot;text-xs line-through&quot; style={{ color: COLORS.fossilGray }}&gt;原價 ${originalPrice}&lt;/span&gt;}&lt;/div&gt;;
};

const SkeletonCard = () =&gt; (
  &lt;div className=&quot;bg-white rounded-lg shadow-sm overflow-hidden border animate-pulse mb-4 break-inside-avoid&quot; style={{ borderColor: COLORS.whiteBucks }}&gt;
    &lt;div className=&quot;aspect-[3/4] bg-gray-200&quot;&gt;&lt;/div&gt;
    &lt;div className=&quot;p-4 space-y-3&quot;&gt;&lt;div className=&quot;h-4 bg-gray-200 rounded w-3/4&quot;&gt;&lt;/div&gt;&lt;div className=&quot;h-4 bg-gray-200 rounded w-1/2&quot;&gt;&lt;/div&gt;&lt;/div&gt;
  &lt;/div&gt;
);

// --- [組件] 自動輪播精選區 ---
const FeaturedCarousel = ({ items, onNavigate }) =&gt; {
  const [activeIndex, setActiveIndex] = useState(0);
  const featuredItems = items.slice(0, 5); 

  useEffect(() =&gt; {
    const interval = setInterval(() =&gt; {
      setActiveIndex((prev) =&gt; (prev + 1) % featuredItems.length);
    }, 4000); 
    return () =&gt; clearInterval(interval);
  }, [featuredItems.length]);

  if (featuredItems.length === 0) return null;
  const currentItem = featuredItems[activeIndex];

  return (
    &lt;div className=&quot;mx-4 mb-8&quot;&gt;
      &lt;div className=&quot;flex items-center gap-2 mb-3&quot;&gt;
        &lt;span className=&quot;bg-orange-500 text-white p-1 rounded-full animate-pulse&quot;&gt;&lt;Flame size={16} fill=&quot;currentColor&quot; /&gt;&lt;/span&gt;
        &lt;h2 className=&quot;text-lg font-bold tracking-wide flex items-center gap-2&quot; style={{ color: COLORS.brownWindmill }}&gt;
           本日精選 
           &lt;span className=&quot;text-xs font-normal px-2 py-0.5 rounded-full bg-orange-100 text-orange-600&quot;&gt;自動更新中&lt;/span&gt;
        &lt;/h2&gt;
      &lt;/div&gt;
      
      &lt;div className=&quot;relative w-full h-48 bg-white rounded-2xl shadow-md overflow-hidden border cursor-pointer group&quot;
           style={{ borderColor: COLORS.whiteBucks }}
           onClick={() =&gt; onNavigate(&#x27;product&#x27;, currentItem)}&gt;
        
        &lt;div key={currentItem.id + &#x27;-bg&#x27;} 
             className=&quot;absolute inset-0 bg-cover bg-center blur-xl opacity-30 animate-pulse-slow transition-all duration-1000 transform scale-110&quot;
             style={{ backgroundImage: `url(${currentItem.cover})` }}&gt;&lt;/div&gt;
        
        &lt;div className=&quot;absolute inset-0 flex items-center p-4 z-10&quot;&gt;
          &lt;div key={currentItem.id + &#x27;-img&#x27;} className=&quot;w-28 h-36 flex-shrink-0 rounded-lg overflow-hidden shadow-lg border border-white transform transition-transform duration-500 hover:scale-105 animate-fade-in-up&quot;&gt;
            &lt;img src={currentItem.cover} alt={currentItem.title} className=&quot;w-full h-full object-cover&quot; /&gt;
          &lt;/div&gt;
          
          &lt;div key={currentItem.id + &#x27;-text&#x27;} className=&quot;flex-1 ml-4 flex flex-col justify-center h-full animate-fade-in-right&quot;&gt;
            &lt;div className=&quot;flex items-start justify-between mb-1&quot;&gt;
               &lt;span className=&quot;text-xs font-bold text-orange-500 bg-orange-50 px-2 py-0.5 rounded-md&quot;&gt;HOT&lt;/span&gt;
               &lt;span className=&quot;text-xs text-gray-400&quot;&gt;{activeIndex + 1} / {featuredItems.length}&lt;/span&gt;
            &lt;/div&gt;
            
            &lt;h3 className=&quot;font-bold text-lg text-[#5D4037] line-clamp-2 leading-tight mb-2&quot;&gt;
              {currentItem.title}
            &lt;/h3&gt;
            
            &lt;div className=&quot;mt-auto&quot;&gt;
               &lt;p className=&quot;text-xs text-gray-500 mb-1&quot;&gt;{currentItem.author}&lt;/p&gt;
               &lt;div className=&quot;flex items-center justify-between&quot;&gt;
                  &lt;PriceDisplay type={currentItem.type} price={currentItem.price} originalPrice={currentItem.originalPrice} /&gt;
                  &lt;div className=&quot;w-8 h-8 rounded-full bg-[#756256] text-white flex items-center justify-center shadow-md transform translate-x-10 group-hover:translate-x-0 transition-transform duration-300&quot;&gt;
                     &lt;ArrowRight size={16} /&gt;
                  &lt;/div&gt;
               &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;

        &lt;div className=&quot;absolute bottom-2 left-0 right-0 flex justify-center gap-1.5 z-20&quot;&gt;
          {featuredItems.map((_, idx) =&gt; (
            &lt;div 
              key={idx} 
              className={`h-1 rounded-full overflow-hidden transition-all duration-300 ${idx === activeIndex ? &#x27;w-6 bg-gray-200&#x27; : &#x27;w-1.5 bg-gray-300&#x27;}`}
            &gt;
                {idx === activeIndex &amp;&amp; (
                    &lt;div className=&quot;h-full bg-[#756256] animate-progress-fill&quot; style={{ width: &#x27;100%&#x27; }}&gt;&lt;/div&gt;
                )}
            &lt;/div&gt;
          ))}
        &lt;/div&gt;
      &lt;/div&gt;
      
      &lt;style&gt;{`
        @keyframes progress-fill {
          from { width: 0%; }
          to { width: 100%; }
        }
        .animate-progress-fill {
          animation: progress-fill 4s linear;
        }
        @keyframes fade-in-up {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
          animation: fade-in-up 0.5s ease-out forwards;
        }
        @keyframes fade-in-right {
          from { opacity: 0; transform: translateX(10px); }
          to { opacity: 1; transform: translateX(0); }
        }
        .animate-fade-in-right {
          animation: fade-in-right 0.5s ease-out forwards;
        }
      `}&lt;/style&gt;
    &lt;/div&gt;
  );
};

// --- 學生戰情室組件 ---
const StudentDashboard = ({ coins, isCheckedIn, onCheckIn, onGoToStore }) =&gt; {
  const [examType, setExamType] = useState(&#x27;gsat&#x27;); 
  const [customData, setCustomData] = useState({ title: &quot;段考&quot;, date: &quot;2026-06-30&quot; });
  const [isEditingCustom, setIsEditingCustom] = useState(false);
  
  const [tickerIndex, setTickerIndex] = useState(0);
  const TICKER_ITEMS = [
      { time: &quot;3分鐘前&quot;, content: &quot;高二 208班 陳同學 上架了《物理講義》&quot; },
      { time: &quot;5分鐘前&quot;, content: &quot;高一 105班 林同學 徵求《國文課本》&quot; },
      { time: &quot;10分鐘前&quot;, content: &quot;高三 301班 王同學 售出了《英文雜誌》&quot; },
      { time: &quot;剛剛&quot;, content: &quot;國二 805班 張同學 加入了 UniBooks&quot; },
  ];

  useEffect(() =&gt; {
      const interval = setInterval(() =&gt; {
          setTickerIndex(prev =&gt; (prev + 1) % TICKER_ITEMS.length);
      }, 3500); // 3.5秒切換一次
      return () =&gt; clearInterval(interval);
  }, []);

  const currentTicker = TICKER_ITEMS[tickerIndex];

  const EXAMS = {
    gsat: { title: &quot;距離學測&quot;, date: &quot;2026-01-20&quot; },
    ast: { title: &quot;距離分科&quot;, date: &quot;2026-07-10&quot; },
    cap: { title: &quot;距離會考&quot;, date: &quot;2026-05-15&quot; },
  };

  const getDaysLeft = () =&gt; {
    const targetDateStr = examType === &#x27;custom&#x27; ? customData.date : EXAMS[examType].date;
    const targetDate = new Date(targetDateStr);
    const today = new Date();
    const diffTime = targetDate - today;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    return diffDays &gt; 0 ? diffDays : 0;
  };

  const getDisplayTitle = () =&gt; {
    if (examType === &#x27;custom&#x27;) return `距離${customData.title}`;
    return EXAMS[examType].title;
  };

  return (
    &lt;div className=&quot;mx-4 mt-4 mb-6 space-y-3&quot;&gt;
      &lt;div className=&quot;grid grid-cols-2 gap-3&quot;&gt;
        &lt;div className=&quot;bg-white p-3 rounded-xl border flex flex-col justify-between h-28 relative overflow-hidden&quot; 
             style={{ borderColor: COLORS.whiteBucks }}&gt;
           &lt;div className=&quot;absolute top-0 right-0 w-16 h-16 bg-red-50 rounded-full -mr-6 -mt-6 z-0&quot;&gt;&lt;/div&gt;
           
           {isEditingCustom ? (
             &lt;div className=&quot;relative z-20 flex flex-col gap-2 h-full justify-center&quot;&gt;
               &lt;input 
                 type=&quot;text&quot; 
                 value={customData.title} 
                 onChange={(e) =&gt; setCustomData({...customData, title: e.target.value})}
                 className=&quot;text-xs border rounded p-1 w-full&quot;
                 placeholder=&quot;考試名稱&quot;
               /&gt;
               &lt;input 
                 type=&quot;date&quot; 
                 value={customData.date} 
                 onChange={(e) =&gt; setCustomData({...customData, date: e.target.value})}
                 className=&quot;text-xs border rounded p-1 w-full&quot;
               /&gt;
               &lt;button 
                 onClick={() =&gt; setIsEditingCustom(false)}
                 className=&quot;text-xs bg-red-500 text-white rounded py-1&quot;
               &gt;
                 完成
               &lt;/button&gt;
             &lt;/div&gt;
           ) : (
             &lt;div className=&quot;relative z-10 h-full flex flex-col justify-between&quot;&gt;
               &lt;div className=&quot;flex items-center justify-between text-xs text-gray-500 font-bold mb-1&quot;&gt;
                 &lt;div className=&quot;flex items-center gap-1&quot;&gt;
                   &lt;Calendar size={14} className=&quot;text-red-500&quot; /&gt;
                   &lt;div className=&quot;relative inline-block group&quot;&gt;
                     &lt;select 
                       value={examType}
                       onChange={(e) =&gt; setExamType(e.target.value)}
                       className=&quot;appearance-none bg-transparent pr-4 outline-none cursor-pointer hover:text-gray-700&quot;
                     &gt;
                       &lt;option value=&quot;gsat&quot;&gt;大學學測&lt;/option&gt;
                       &lt;option value=&quot;ast&quot;&gt;大學分科&lt;/option&gt;
                       &lt;option value=&quot;cap&quot;&gt;國中會考&lt;/option&gt;
                       &lt;option value=&quot;custom&quot;&gt;自訂...&lt;/option&gt;
                     &lt;/select&gt;
                     &lt;ChevronDown size={10} className=&quot;absolute right-0 top-1/2 -translate-y-1/2 pointer-events-none&quot; /&gt;
                   &lt;/div&gt;
                 &lt;/div&gt;
                 {examType === &#x27;custom&#x27; &amp;&amp; (
                   &lt;button onClick={() =&gt; setIsEditingCustom(true)} className=&quot;text-gray-400 hover:text-gray-600&quot;&gt;
                     &lt;Settings size={12} /&gt;
                   &lt;/button&gt;
                 )}
               &lt;/div&gt;
               
               &lt;div className=&quot;flex items-baseline gap-1&quot;&gt;
                 &lt;span className=&quot;text-4xl font-bold text-gray-800&quot;&gt;{getDaysLeft()}&lt;/span&gt;
                 &lt;span className=&quot;text-xs text-gray-500&quot;&gt;天&lt;/span&gt;
               &lt;/div&gt;
               
               &lt;div className=&quot;text-[10px] text-gray-400 mt-1 truncate&quot;&gt;
                 {getDisplayTitle()}
               &lt;/div&gt;
             &lt;/div&gt;
           )}
        &lt;/div&gt;

        &lt;div onClick={isCheckedIn ? undefined : onCheckIn} 
             className={`p-3 rounded-xl border flex flex-col justify-between h-28 cursor-pointer transition-all relative overflow-hidden group
             ${isCheckedIn ? &#x27;bg-[#FDFBF7]&#x27; : &#x27;bg-white hover:border-[#A58976]&#x27;}`}
             style={{ borderColor: isCheckedIn ? COLORS.whiteBucks : COLORS.whiteBucks }}&gt;
           
           &lt;div className=&quot;absolute top-0 right-0 w-16 h-16 bg-yellow-50 rounded-full -mr-6 -mt-6 z-0&quot;&gt;&lt;/div&gt;
           
           &lt;div className=&quot;relative z-10 flex flex-col h-full justify-between&quot;&gt;
             &lt;div className=&quot;flex items-center justify-between&quot;&gt;
               &lt;div className=&quot;flex items-center gap-1 text-xs text-gray-500 font-bold&quot;&gt;
                 &lt;Coins size={14} className=&quot;text-yellow-500&quot; /&gt; 書香幣
               &lt;/div&gt;
               &lt;div className=&quot;text-xs font-bold text-[#756256]&quot;&gt;{coins}&lt;/div&gt;
             &lt;/div&gt;
             
             {isCheckedIn ? (
               &lt;div className=&quot;text-center py-1 animate-fade-in flex flex-col items-center&quot;&gt;
                 &lt;CheckCircle size={20} className=&quot;text-green-500 mb-1&quot; /&gt;
                 &lt;div className=&quot;text-xs text-green-600 font-bold mb-2&quot;&gt;已簽到&lt;/div&gt;
                 &lt;button 
                    onClick={(e) =&gt; { e.stopPropagation(); onGoToStore(); }}
                    className=&quot;flex items-center gap-1 px-3 py-1 bg-[#756256] text-white text-[10px] rounded-full shadow hover:bg-[#5D4E44] transition-colors&quot;
                 &gt;
                    &lt;ShoppingBag size={10} /&gt; 去兌換
                 &lt;/button&gt;
               &lt;/div&gt;
             ) : (
               &lt;div className=&quot;text-center&quot;&gt;
                 &lt;div className=&quot;w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-1 group-hover:scale-110 transition-transform&quot;&gt;
                   &lt;Plus size={20} className=&quot;text-yellow-600&quot; /&gt;
                 &lt;/div&gt;
                 &lt;div className=&quot;text-xs text-gray-600 font-bold&quot;&gt;點我簽到 +5&lt;/div&gt;
               &lt;/div&gt;
             )}
           &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div className=&quot;bg-white rounded-lg border px-3 py-2 flex items-center gap-3 shadow-sm&quot; style={{ borderColor: COLORS.whiteBucks }}&gt;
        &lt;div className=&quot;bg-red-50 text-red-500 p-1 rounded-md&quot;&gt;
          &lt;Zap size={14} fill=&quot;currentColor&quot; /&gt;
        &lt;/div&gt;
        &lt;div className=&quot;flex-1 overflow-hidden h-5 relative&quot;&gt;
          &lt;div key={tickerIndex} className=&quot;absolute animate-slide-up text-xs font-medium text-gray-600 w-full truncate&quot;&gt;
            &lt;span className=&quot;font-bold text-[#756256] mr-1&quot;&gt;{currentTicker.time}&lt;/span&gt;
            {currentTicker.content}
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};

// --- 許願池組件 ---
const WishingWell = ({ wishes, onAddWish, currentUser, currentAvatar }) =&gt; {
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [content, setContent] = useState(&quot;&quot;);

  const handleSubmit = () =&gt; {
    if (!content.trim()) return;
    onAddWish(content);
    setContent(&quot;&quot;);
    setIsModalOpen(false);
  };

  return (
    &lt;div className=&quot;mb-8 px-4&quot;&gt;
      &lt;div className=&quot;flex items-center gap-2 mb-3&quot;&gt;
        &lt;span className=&quot;bg-yellow-400 text-white p-1 rounded-full&quot;&gt;&lt;Sparkles size={16} fill=&quot;currentColor&quot; /&gt;&lt;/span&gt;
        &lt;h2 className=&quot;text-lg font-bold tracking-wide&quot; style={{ color: COLORS.brownWindmill }}&gt;許願池&lt;/h2&gt;
      &lt;/div&gt;
      &lt;div className=&quot;bg-white rounded-xl shadow-sm border p-4 space-y-3&quot; style={{ borderColor: COLORS.whiteBucks }}&gt;
        {wishes.map(wish =&gt; (
          &lt;div key={wish.id} className=&quot;flex gap-3 border-b last:border-0 pb-3 last:pb-0&quot; style={{ borderColor: COLORS.bgLight }}&gt;
            &lt;div className=&quot;w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center flex-shrink-0 overflow-hidden&quot;&gt;
               &lt;User size={20} className=&quot;text-gray-400&quot;/&gt;
            &lt;/div&gt;
            &lt;div className=&quot;flex-1&quot;&gt;
              &lt;div className=&quot;flex justify-between items-center mb-1&quot;&gt;
                &lt;span className=&quot;text-sm font-bold text-[#756256]&quot;&gt;{wish.user}&lt;/span&gt;
                &lt;span className=&quot;text-xs font-normal text-gray-400&quot;&gt;{wish.time}&lt;/span&gt;
              &lt;/div&gt;
              &lt;p className=&quot;text-sm text-[#9E9081]&quot;&gt;{wish.content}&lt;/p&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        ))}
        &lt;button 
          onClick={() =&gt; setIsModalOpen(true)}
          className=&quot;w-full py-2 mt-2 text-xs font-bold text-[#9E9081] border border-dashed hover:bg-[#F9F7F5] rounded-lg transition-colors flex items-center justify-center gap-1&quot; 
          style={{ borderColor: COLORS.fossilGray }}
        &gt;
          &lt;Plus size={14} /&gt; 我也想許願
        &lt;/button&gt;
      &lt;/div&gt;

      {isModalOpen &amp;&amp; (
        &lt;div className=&quot;fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fade-in&quot;&gt;
           &lt;div className=&quot;bg-white w-full max-w-md rounded-xl overflow-hidden shadow-2xl animate-scale-up flex flex-col h-[60vh] md:h-auto&quot;&gt;
              &lt;div className=&quot;flex justify-between items-center p-3 border-b&quot; style={{ borderColor: COLORS.whiteBucks }}&gt;
                 &lt;button onClick={() =&gt; setIsModalOpen(false)} className=&quot;p-1&quot;&gt;&lt;X size={24} className=&quot;text-gray-600&quot;/&gt;&lt;/button&gt;
                 &lt;span className=&quot;font-bold text-[#756256] text-lg&quot;&gt;建立許願&lt;/span&gt;
                 &lt;button 
                   onClick={handleSubmit} 
                   className=&quot;text-blue-500 font-bold text-sm px-2 py-1 rounded hover:bg-blue-50 disabled:opacity-50 disabled:hover:bg-transparent&quot;
                   disabled={!content.trim()}
                 &gt;
                   發佈
                 &lt;/button&gt;
              &lt;/div&gt;
              
              &lt;div className=&quot;p-4 flex flex-col flex-1&quot;&gt;
                 &lt;div className=&quot;flex items-center gap-3 mb-4&quot;&gt;
                    &lt;div className=&quot;w-10 h-10 rounded-full bg-gray-200 overflow-hidden border border-gray-100&quot;&gt;
                       &lt;img src={currentAvatar?.src} alt=&quot;avatar&quot; className=&quot;w-full h-full object-cover&quot;/&gt;
                    &lt;/div&gt;
                    &lt;span className=&quot;font-bold text-[#5D4037]&quot;&gt;{currentUser?.name || &quot;同學&quot;}&lt;/span&gt;
                 &lt;/div&gt;
                 &lt;textarea 
                   className=&quot;flex-1 w-full resize-none outline-none text-[#5D4037] placeholder-gray-400 text-lg leading-relaxed&quot;
                   placeholder=&quot;寫下你想找的書或是筆記...&quot;
                   value={content}
                   onChange={(e) =&gt; setContent(e.target.value)}
                   autoFocus
                 /&gt;
              &lt;/div&gt;
              
              &lt;div className=&quot;p-3 border-t bg-gray-50 flex gap-4 text-gray-400&quot;&gt;
                  &lt;Camera size={20} className=&quot;cursor-pointer hover:text-[#756256] transition-colors&quot; /&gt;
                  &lt;Tag size={20} className=&quot;cursor-pointer hover:text-[#756256] transition-colors&quot; /&gt;
              &lt;/div&gt;
           &lt;/div&gt;
        &lt;/div&gt;
      )}
    &lt;/div&gt;
  );
};

// --- 登入頁面 ---
const LoginPage = ({ onLogin }) =&gt; {
  const [isLoading, setIsLoading] = useState(false);
  const handleLogin = (type) =&gt; { 
    setIsLoading(true); 
    setTimeout(() =&gt; onLogin({ ...MOCK_USER_PROFILE, email: type === &#x27;school&#x27; ? &quot;s112501@school.edu.tw&quot; : &quot;test@gmail.com&quot; }), 1000); 
  };
  return (
    &lt;div className=&quot;min-h-screen flex items-center justify-center px-4&quot; style={{ ...fontStyle, backgroundColor: COLORS.bgLight, color: COLORS.brownWindmill }}&gt;
      &lt;div className=&quot;max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center border&quot; style={{ borderColor: COLORS.whiteBucks }}&gt;
        &lt;h2 className=&quot;text-2xl font-bold mb-2&quot; style={{ color: COLORS.brownWindmill }}&gt;歡迎回到循環平台&lt;/h2&gt;
        &lt;p className=&quot;text-sm mb-6&quot; style={{ color: COLORS.brushwood }}&gt;讓閒置的講義，找到新的主人&lt;/p&gt;
        &lt;button onClick={() =&gt; handleLogin(&#x27;school&#x27;)} className=&quot;w-full py-3 rounded-xl border-2 font-bold mb-3 hover:bg-gray-50 flex items-center justify-center gap-2&quot; style={{ borderColor: COLORS.whiteBucks, color: COLORS.brownWindmill }}&gt;
          &lt;Mail size={18} /&gt; 使用 Google 帳號登入 (校內)
        &lt;/button&gt;
        &lt;button onClick={() =&gt; handleLogin(&#x27;external&#x27;)} className=&quot;text-xs text-gray-400 hover:underline&quot;&gt;(開發測試) 使用私人 Gmail&lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};

// --- 商品詳情頁 ---
const ProductDetailPage = ({ product, onBack, onContact }) =&gt; {
  if (!product) return null;
  return (
    &lt;div className=&quot;min-h-screen pb-24 bg-white&quot; style={fontStyle}&gt;
      &lt;nav className=&quot;fixed top-0 w-full z-50 flex justify-between items-center px-4 py-3 bg-white/80 backdrop-blur-md border-b&quot; style={{ borderColor: COLORS.whiteBucks }}&gt;
        &lt;button onClick={onBack} className=&quot;p-2 rounded-full bg-gray-100 hover:bg-gray-200&quot;&gt;&lt;ChevronLeft size={20} color={COLORS.brownWindmill} /&gt;&lt;/button&gt;
        &lt;div className=&quot;flex gap-3&quot;&gt;
          &lt;button className=&quot;p-2 rounded-full hover:bg-gray-100&quot;&gt;&lt;Share2 size={20} color={COLORS.brownWindmill} /&gt;&lt;/button&gt;
          &lt;button className=&quot;p-2 rounded-full hover:bg-gray-100&quot;&gt;&lt;Heart size={20} color={COLORS.brownWindmill} /&gt;&lt;/button&gt;
        &lt;/div&gt;
      &lt;/nav&gt;
      
      &lt;div className=&quot;pt-16 pb-6&quot;&gt;
        &lt;div className=&quot;aspect-[4/3] bg-gray-100 relative&quot;&gt;
          &lt;img src={product.cover} alt={product.title} className=&quot;w-full h-full object-contain bg-[#F9F7F5]&quot; /&gt;
        &lt;/div&gt;
        
        &lt;div className=&quot;px-5 mt-6&quot;&gt;
          &lt;div className=&quot;flex gap-2 mb-2&quot;&gt;
            &lt;span className=&quot;text-xs font-bold px-2 py-1 rounded bg-[#F9F7F5] text-[#9E9081]&quot;&gt;{product.subject}&lt;/span&gt;
            &lt;span className=&quot;text-xs font-bold px-2 py-1 rounded bg-[#F9F7F5] text-[#9E9081]&quot;&gt;{product.grade}&lt;/span&gt;
          &lt;/div&gt;
          &lt;h1 className=&quot;text-2xl font-bold mb-1 leading-tight&quot; style={{ color: COLORS.brownWindmill }}&gt;{product.title}&lt;/h1&gt;
          &lt;p className=&quot;text-sm text-gray-500 mb-4&quot;&gt;{product.author} · {product.publisher}&lt;/p&gt;
          
          &lt;div className=&quot;flex items-end gap-3 mb-6 pb-6 border-b&quot; style={{ borderColor: COLORS.whiteBucks }}&gt;
             &lt;PriceDisplay type={product.type} price={product.price} originalPrice={product.originalPrice} large /&gt;
          &lt;/div&gt;

          &lt;div className=&quot;space-y-4&quot;&gt;
             &lt;div&gt;
                &lt;h3 className=&quot;text-sm font-bold text-[#9E9081] mb-2&quot;&gt;商品狀況&lt;/h3&gt;
                &lt;p className=&quot;text-gray-700&quot;&gt;{product.conditionLevel} · {product.location}面交&lt;/p&gt;
             &lt;/div&gt;
             &lt;div&gt;
                &lt;h3 className=&quot;text-sm font-bold text-[#9E9081] mb-2&quot;&gt;賣家描述&lt;/h3&gt;
                &lt;p className=&quot;text-gray-700 leading-relaxed&quot;&gt;{product.description || &quot;賣家未提供詳細描述。&quot;}&lt;/p&gt;
             &lt;/div&gt;
             &lt;div&gt;
                &lt;h3 className=&quot;text-sm font-bold text-[#9E9081] mb-2&quot;&gt;賣家資訊&lt;/h3&gt;
                &lt;div className=&quot;flex items-center gap-3 p-3 rounded-lg bg-[#F9F7F5]&quot;&gt;
                   &lt;div className=&quot;w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center&quot;&gt;
                      &lt;User size={20} className=&quot;text-gray-500&quot; /&gt;
                   &lt;/div&gt;
                   &lt;div&gt;
                      &lt;div className=&quot;font-bold text-[#756256]&quot;&gt;{product.seller.name}&lt;/div&gt;
                      &lt;div className=&quot;text-xs text-gray-500 flex items-center gap-1&quot;&gt;
                         &lt;Star size={10} fill=&quot;#fbbf24&quot; className=&quot;text-yellow-400&quot; /&gt; {product.seller.score}
                      &lt;/div&gt;
                   &lt;/div&gt;
                &lt;/div&gt;
             &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div className=&quot;fixed bottom-0 left-0 w-full p-4 bg-white border-t safe-area-bottom flex gap-3&quot; style={{ borderColor: COLORS.whiteBucks }}&gt;
         &lt;button onClick={onContact} className=&quot;flex-1 py-3 bg-[#756256] text-white rounded-xl font-bold shadow-lg hover:bg-[#5D4E44] transition-colors flex items-center justify-center gap-2&quot;&gt;
            &lt;MessageCircle size={18} /&gt; 聯絡賣家
         &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};

// --- [修改] 首頁 (HomePage) ---
// 接收 onGoToStore 並傳遞給 StudentDashboard
const HomePage = ({ onNavigate, user, unreadCount, currentAvatarId, coins, isCheckedIn, onCheckIn, wishes, onAddWish, notifications, onReadNotification, onGoToStore }) =&gt; {
  const [searchQuery, setSearchQuery] = useState(&#x27;&#x27;);
  const [isLoading, setIsLoading] = useState(true);
  
  // 新增：分類選擇狀態
  const [selectedCategory, setSelectedCategory] = useState(&#x27;all&#x27;);
  // 新增：通知小視窗開關
  const [showNotifications, setShowNotifications] = useState(false);

  const [filterGrade, setFilterGrade] = useState(&#x27;all&#x27;);
  const [filterSubject, setFilterSubject] = useState(&#x27;all&#x27;);
  const [filterPublisher, setFilterPublisher] = useState(&#x27;all&#x27;);

  useEffect(() =&gt; {
    const timer = setTimeout(() =&gt; setIsLoading(false), 1500);
    return () =&gt; clearTimeout(timer);
  }, []);

  const handleResetHome = () =&gt; {
    setSelectedCategory(&#x27;all&#x27;); // 重置分類
    setFilterGrade(&#x27;all&#x27;); 
    setFilterSubject(&#x27;all&#x27;); 
    setFilterPublisher(&#x27;all&#x27;); 
    setSearchQuery(&#x27;&#x27;);
    window.scrollTo({ top: 0, behavior: &#x27;smooth&#x27; });
  };

  // 處理點擊分類標籤
  const handleCategoryClick = (catId) =&gt; {
    setSelectedCategory(catId);
    setSearchQuery(&#x27;&#x27;);
    setFilterGrade(&#x27;all&#x27;);
    setFilterSubject(&#x27;all&#x27;);
    setFilterPublisher(&#x27;all&#x27;);
    // 點擊分類時自動滾動到列表區
    if (catId !== &#x27;all&#x27;) {
       window.scrollTo({ top: 0, behavior: &#x27;smooth&#x27; });
    }
  };

  // 核心過濾邏輯
  const filteredBooks = RECENT_BOOKS.filter(book =&gt; {
    const query = searchQuery.toLowerCase();
    
    // 1. 搜尋框過濾
    const keywordMatch = !query.trim() || 
        book.title.toLowerCase().includes(query) || 
        book.seller.name.toLowerCase().includes(query);

    // 2. 下拉選單過濾
    const gradeMatch = filterGrade === &#x27;all&#x27; || book.grade === filterGrade;
    const subjectMatch = filterSubject === &#x27;all&#x27; || book.subject === filterSubject;
    const publisherMatch = filterPublisher === &#x27;all&#x27; || book.publisher === filterPublisher;

    // 3. 頂部標籤過濾邏輯
    let categoryMatch = true;
    if (selectedCategory !== &#x27;all&#x27;) {
       if (selectedCategory === &#x27;chi&#x27;) categoryMatch = book.subject === &#x27;國文&#x27;;
       else if (selectedCategory === &#x27;eng&#x27;) categoryMatch = book.subject === &#x27;英文&#x27;;
       else if (selectedCategory === &#x27;math&#x27;) categoryMatch = book.subject === &#x27;數學&#x27;;
       else if (selectedCategory === &#x27;sci&#x27;) categoryMatch = [&#x27;物理&#x27;, &#x27;化學&#x27;, &#x27;生物&#x27;, &#x27;地科&#x27;, &#x27;理化&#x27;].includes(book.subject) || book.subject === &#x27;自然&#x27;;
       else if (selectedCategory === &#x27;soc&#x27;) categoryMatch = [&#x27;歷史&#x27;, &#x27;地理&#x27;, &#x27;公民&#x27;].includes(book.subject) || book.subject === &#x27;社會&#x27;;
       else if (selectedCategory === &#x27;exam&#x27;) categoryMatch = book.grade === &#x27;高三&#x27; || book.title.includes(&#x27;學測&#x27;);
       else if (selectedCategory === &#x27;cap&#x27;) categoryMatch = book.grade.includes(&#x27;國&#x27;) || book.title.includes(&#x27;會考&#x27;);
    }

    return keywordMatch &amp;&amp; gradeMatch &amp;&amp; subjectMatch &amp;&amp; publisherMatch &amp;&amp; categoryMatch;
  });

  const noteProducts = RECENT_BOOKS.filter(item =&gt; item.productType === &#x27;note&#x27;);
  const currentAvatar = AVATAR_LIST.find(a =&gt; a.id === currentAvatarId) || AVATAR_LIST[0];

  const showFullHome = selectedCategory === &#x27;all&#x27; &amp;&amp; !searchQuery;

  return (
    &lt;div className=&quot;min-h-screen pb-20&quot; style={{ ...fontStyle, backgroundColor: COLORS.bgLight, color: COLORS.brownWindmill }}&gt;
      {/* Hero Section */}
      &lt;div className=&quot;pt-6 pb-12 px-4 rounded-b-[2rem] shadow-lg transition-all duration-500&quot; 
           style={{ 
             background: `linear-gradient(135deg, ${COLORS.chocolateBubble}, ${COLORS.brownWindmill})`, 
             color: COLORS.bgLight,
             paddingBottom: showFullHome ? &#x27;3rem&#x27; : &#x27;2rem&#x27;,
             borderRadius: showFullHome ? &#x27;0 0 2rem 2rem&#x27; : &#x27;0 0 1.5rem 1.5rem&#x27;
           }}&gt;
        &lt;div className=&quot;max-w-6xl mx-auto&quot;&gt;
          {/* Header */}
          &lt;div className=&quot;flex justify-between items-center mb-6&quot;&gt;
            &lt;div className=&quot;flex items-center gap-2&quot;&gt;
               &lt;div className=&quot;w-8 h-8 backdrop-blur rounded-sm flex items-center justify-center font-bold font-serif&quot; 
                    style={{ backgroundColor: &#x27;rgba(255,255,255,0.2)&#x27; }}&gt;校&lt;/div&gt;
               &lt;span className=&quot;text-xl font-bold tracking-widest&quot;&gt;循環平台&lt;/span&gt;
            &lt;/div&gt;
            &lt;div className=&quot;flex items-center gap-3 relative&quot;&gt;
              &lt;button onClick={handleResetHome} className=&quot;p-2 hover:bg-white/10 rounded-full transition-colors&quot;&gt;&lt;Home size={20} /&gt;&lt;/button&gt;
              
              {/* 書香幣顯示按鈕 */}
              &lt;div className=&quot;flex items-center gap-1 px-3 py-1.5 rounded-full bg-black/20 border border-white/10 text-white text-xs font-bold shadow-sm backdrop-blur-sm&quot;&gt;
                &lt;Coins size={14} className=&quot;text-yellow-400&quot; fill=&quot;currentColor&quot; /&gt;
                &lt;span&gt;{coins}&lt;/span&gt;
              &lt;/div&gt;

              {/* 通知鈴鐺與下拉視窗 */}
              &lt;div className=&quot;relative&quot;&gt;
                  &lt;button onClick={() =&gt; setShowNotifications(!showNotifications)} className=&quot;relative p-2 hover:bg-white/10 rounded-full transition-colors&quot;&gt;
                    &lt;Bell size={20} /&gt;
                    {unreadCount &gt; 0 &amp;&amp; &lt;span className=&quot;absolute top-1 right-1 min-w-[16px] h-4 bg-red-500 rounded-full flex items-center justify-center text-[10px] font-bold text-white px-1&quot;&gt;{unreadCount &gt; 9 ? &#x27;9+&#x27; : unreadCount}&lt;/span&gt;}
                  &lt;/button&gt;

                  {/* 通知小視窗 */}
                  {showNotifications &amp;&amp; (
                      &lt;div className=&quot;absolute top-full right-0 mt-2 w-80 bg-white rounded-xl shadow-2xl border overflow-hidden z-50 animate-scale-up&quot; style={{ borderColor: COLORS.whiteBucks }}&gt;
                          &lt;div className=&quot;px-4 py-3 border-b flex justify-between items-center&quot; style={{ borderColor: COLORS.bgLight }}&gt;
                              &lt;span className=&quot;font-bold text-[#756256]&quot;&gt;通知中心&lt;/span&gt;
                              &lt;button onClick={() =&gt; setShowNotifications(false)}&gt;&lt;X size={16} className=&quot;text-gray-400 hover:text-gray-600&quot;/&gt;&lt;/button&gt;
                          &lt;/div&gt;
                          &lt;div className=&quot;max-h-80 overflow-y-auto divide-y&quot; style={{ borderColor: COLORS.bgLight }}&gt;
                              {notifications.length === 0 ? (
                                  &lt;div className=&quot;p-4 text-center text-xs text-gray-400&quot;&gt;目前沒有通知&lt;/div&gt;
                              ) : (
                                  notifications.map(n =&gt; (
                                      &lt;div 
                                        key={n.id} 
                                        onClick={() =&gt; onReadNotification(n.id)} 
                                        className={`flex items-start gap-3 p-3 cursor-pointer hover:bg-gray-50 transition-colors ${n.isRead ? &#x27;bg-white&#x27; : &#x27;bg-[#FDFBF7]&#x27;}`}
                                      &gt;
                                          &lt;div className={`w-2 h-2 rounded-full mt-1.5 flex-shrink-0 ${n.isRead ? &#x27;bg-transparent&#x27; : &#x27;bg-red-500&#x27;}`}&gt;&lt;/div&gt;
                                          &lt;div className=&quot;flex-1&quot;&gt;
                                              &lt;p className=&quot;text-xs font-bold text-[#756256] mb-0.5&quot;&gt;{n.user || &quot;系統通知&quot;}&lt;/p&gt;
                                              &lt;p className={`text-xs ${n.isRead ? &#x27;text-gray-500&#x27; : &#x27;text-gray-800 font-medium&#x27;}`}&gt;{n.content}&lt;/p&gt;
                                              &lt;p className=&quot;text-[10px] text-gray-400 mt-1&quot;&gt;{n.time}&lt;/p&gt;
                                          &lt;/div&gt;
                                      &lt;/div&gt;
                                  ))
                              )}
                          &lt;/div&gt;
                      &lt;/div&gt;
                  )}
              &lt;/div&gt;

              &lt;button onClick={() =&gt; onNavigate(&#x27;profile&#x27;)} className=&quot;flex items-center gap-2 hover:bg-white/20 pl-1 pr-3 py-1 rounded-full transition-all border border-white/20&quot; style={{ backgroundColor: &#x27;rgba(255,255,255,0.1)&#x27; }}&gt;
                &lt;div className=&quot;w-7 h-7 rounded-full flex items-center justify-center overflow-hidden bg-white p-0.5&quot;&gt;
                   &lt;img src={currentAvatar.src} alt=&quot;avatar&quot; className=&quot;w-full h-full object-cover rounded-full&quot;/&gt;
                &lt;/div&gt;
                &lt;span className=&quot;hidden sm:inline text-sm font-medium tracking-wide&quot;&gt;{user?.name}&lt;/span&gt;
              &lt;/button&gt;
            &lt;/div&gt;
          &lt;/div&gt;

          {/* Slogan &amp; Search Area */}
          &lt;div className=&quot;max-w-3xl mx-auto mt-2&quot;&gt;
            {showFullHome &amp;&amp; &lt;h1 className=&quot;text-2xl md:text-3xl font-bold mb-4 tracking-widest text-center animate-fade-in&quot;&gt;讓知識流動，讓學分 All Pass！&lt;/h1&gt;}
            &lt;div className=&quot;bg-[#FDFBF7] rounded-xl shadow-xl overflow-hidden p-2&quot;&gt;
              &lt;div className=&quot;flex items-center border-b px-2&quot; style={{ borderColor: COLORS.whiteBucks }}&gt;
                &lt;Search className=&quot;text-[#9E9081]&quot; size={20} /&gt;
                &lt;input type=&quot;text&quot; value={searchQuery} onChange={(e) =&gt; setSearchQuery(e.target.value)} placeholder=&quot;搜尋書名、ISBN 或 賣家...&quot; className=&quot;w-full py-3 px-4 bg-transparent text-[#756256] placeholder-[#C9C3B6] outline-none&quot; /&gt;
                {searchQuery &amp;&amp; &lt;button onClick={() =&gt; setSearchQuery(&#x27;&#x27;)} className=&quot;text-[#9E9081]&quot;&gt;&lt;X size={16} /&gt;&lt;/button&gt;}
              &lt;/div&gt;
              &lt;div className=&quot;grid grid-cols-3 divide-x&quot; style={{ borderColor: COLORS.whiteBucks }}&gt;
                &lt;div className=&quot;relative&quot;&gt;&lt;select value={filterGrade} onChange={(e) =&gt; setFilterGrade(e.target.value)} className=&quot;w-full appearance-none bg-transparent py-2 pl-3 pr-6 text-sm font-bold text-[#756256] outline-none cursor-pointer hover:bg-gray-50&quot;&gt;&lt;option value=&quot;all&quot;&gt;所有年級&lt;/option&gt;{GRADES.map(g =&gt; &lt;option key={g} value={g}&gt;{g}&lt;/option&gt;)}&lt;/select&gt;&lt;ChevronDown size={14} className=&quot;absolute right-2 top-1/2 -translate-y-1/2 text-[#9E9081] pointer-events-none&quot; /&gt;&lt;/div&gt;
                &lt;div className=&quot;relative&quot;&gt;&lt;select value={filterSubject} onChange={(e) =&gt; setFilterSubject(e.target.value)} className=&quot;w-full appearance-none bg-transparent py-2 pl-3 pr-6 text-sm font-bold text-[#756256] outline-none cursor-pointer hover:bg-gray-50&quot;&gt;&lt;option value=&quot;all&quot;&gt;所有科目&lt;/option&gt;{SUBJECTS.map(s =&gt; &lt;option key={s} value={s}&gt;{s}&lt;/option&gt;)}&lt;/select&gt;&lt;ChevronDown size={14} className=&quot;absolute right-2 top-1/2 -translate-y-1/2 text-[#9E9081] pointer-events-none&quot; /&gt;&lt;/div&gt;
                &lt;div className=&quot;relative&quot;&gt;&lt;select value={filterPublisher} onChange={(e) =&gt; setFilterPublisher(e.target.value)} className=&quot;w-full appearance-none bg-transparent py-2 pl-3 pr-6 text-sm font-bold text-[#756256] outline-none cursor-pointer hover:bg-gray-50&quot;&gt;&lt;option value=&quot;all&quot;&gt;所有版本&lt;/option&gt;{PUBLISHERS.map(p =&gt; &lt;option key={p} value={p}&gt;{p}&lt;/option&gt;)}&lt;/select&gt;&lt;ChevronDown size={14} className=&quot;absolute right-2 top-1/2 -translate-y-1/2 text-[#9E9081] pointer-events-none&quot; /&gt;&lt;/div&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div className=&quot;max-w-6xl mx-auto px-4 -mt-6&quot;&gt;
        
        {/* Categories Tabs */}
        &lt;div className=&quot;flex gap-3 overflow-x-auto pb-4 no-scrollbar&quot;&gt;
          {CATEGORIES.map(cat =&gt; (
            &lt;button 
                key={cat.id} 
                onClick={() =&gt; handleCategoryClick(cat.id)} 
                className={`whitespace-nowrap px-5 py-2 rounded-full text-sm tracking-wide shadow-sm transition-all border
                ${selectedCategory === cat.id ? &#x27;bg-[#756256] text-white border-[#756256] ring-2 ring-offset-1 ring-[#756256]&#x27; : &#x27;bg-[#F9F7F5] text-[#756256] border-[#E8E3DF] hover:bg-white&#x27;}`} 
            &gt;
                {cat.name}
            &lt;/button&gt;
          ))}
        &lt;/div&gt;

        {/* 只有在首頁模式 (selectedCategory === &#x27;all&#x27;) 且無搜尋時，才顯示 Dashboard / Carousel / Wishes */}
        {showFullHome &amp;&amp; (
            &lt;div className=&quot;animate-fade-in&quot;&gt;
                {/* [修改] 學生戰情室 - 傳遞 onGoToStore */}
                &lt;StudentDashboard 
                    coins={coins} 
                    isCheckedIn={isCheckedIn} 
                    onCheckIn={onCheckIn} 
                    onGoToStore={onGoToStore}
                /&gt;

                {/* 自動輪播推薦區 */}
                &lt;FeaturedCarousel items={RECENT_BOOKS.filter(b =&gt; b.productType === &#x27;note&#x27; || b.conditionLevel === &#x27;全新&#x27;)} onNavigate={onNavigate} /&gt;

                {/* 許願池 */}
                &lt;WishingWell 
                   wishes={wishes} 
                   onAddWish={onAddWish} 
                   currentUser={user} 
                   currentAvatar={currentAvatar}
                /&gt;
            &lt;/div&gt;
        )}

        {/* Featured Section (Masonry) - 搜尋結果或分類結果顯示區 */}
        &lt;div className=&quot;pb-8 mt-4&quot;&gt;
          &lt;div className=&quot;flex justify-between items-end mb-4 px-1 border-b pb-2&quot; style={{ borderColor: COLORS.whiteBucks }}&gt;
            &lt;h2 className=&quot;text-xl font-bold flex items-center gap-2 tracking-wide&quot; style={{ color: COLORS.brownWindmill }}&gt;
              &lt;Book size={20} style={{ color: COLORS.chocolateBubble }} /&gt;
              {/* 動態標題 */}
              {selectedCategory !== &#x27;all&#x27; 
                  ? CATEGORIES.find(c =&gt; c.id === selectedCategory)?.name + &#x27;專區&#x27;
                  : searchQuery ? &#x27;搜尋結果&#x27; : &#x27;探索發現&#x27;}
            &lt;/h2&gt;
          &lt;/div&gt;

          {/* [修正] 分離空狀態與書籍列表的渲染，避免瀑布流樣式影響空狀態顯示 */}
          {isLoading ? (
             &lt;div className=&quot;columns-2 md:columns-3 lg:columns-4 gap-4 animate-fade-in space-y-4&quot;&gt;
                {Array.from({ length: 6 }).map((_, index) =&gt; &lt;SkeletonCard key={index} /&gt;)}
             &lt;/div&gt;
          ) : filteredBooks.length &gt; 0 ? (
             &lt;div className=&quot;columns-2 md:columns-3 lg:columns-4 gap-4 animate-fade-in space-y-4&quot;&gt;
                {filteredBooks.map((book) =&gt; (
                  &lt;div key={book.id} onClick={() =&gt; onNavigate(&#x27;product&#x27;, book)} 
                    className=&quot;bg-white rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-all cursor-pointer break-inside-avoid mb-4 border&quot;
                    style={{ borderColor: COLORS.whiteBucks }}
                  &gt;
                    &lt;div className=&quot;relative&quot; style={{ backgroundColor: COLORS.bgLight }}&gt;
                      &lt;img src={book.cover} alt={book.title} className=&quot;w-full object-cover&quot; /&gt;
                      &lt;div className={`absolute top-0 right-0 text-white text-[10px] px-3 py-1 rounded-bl-lg font-bold tracking-wider shadow-sm`}
                           style={{ backgroundColor: book.type === &#x27;exchange&#x27; ? COLORS.brushwood : book.type === &#x27;gift&#x27; ? COLORS.chocolateBubble : COLORS.brownWindmill }}&gt;
                        {book.type === &#x27;exchange&#x27; ? &#x27;交換&#x27; : book.type === &#x27;gift&#x27; ? &#x27;贈送&#x27; : &#x27;販售&#x27;}
                      &lt;/div&gt;
                      {book.productType === &#x27;note&#x27; &amp;&amp; (
                        &lt;div className=&quot;absolute top-0 left-0 bg-yellow-500 text-white text-[10px] px-2 py-1 rounded-br-lg font-bold shadow-sm&quot;&gt;
                          筆記
                        &lt;/div&gt;
                      )}
                    &lt;/div&gt;
                    &lt;div className=&quot;p-3&quot;&gt;
                      &lt;h3 className=&quot;font-bold text-sm leading-tight mb-1&quot; style={{ color: COLORS.brownWindmill }}&gt;{book.title}&lt;/h3&gt;
                      &lt;div className=&quot;text-xs text-stone-400 mb-2&quot;&gt;{book.author}&lt;/div&gt;

                      &lt;div className=&quot;mt-auto border-t pt-2&quot; style={{ borderColor: COLORS.whiteBucks }}&gt;
                        &lt;div className=&quot;flex items-end justify-between&quot;&gt;
                          &lt;PriceDisplay type={book.type} price={book.price} originalPrice={book.originalPrice} /&gt;
                        &lt;/div&gt;
                        &lt;div className=&quot;flex items-center gap-1 mt-1&quot;&gt;
                          &lt;span className=&quot;text-[10px] text-gray-400 truncate max-w-[80px]&quot;&gt;@{book.seller.name}&lt;/span&gt;
                          &lt;div className=&quot;flex items-center text-[10px] font-bold px-1 rounded bg-gray-50 text-orange-400&quot;&gt;
                            &lt;Heart size={8} fill=&quot;currentColor&quot; className=&quot;mr-0.5&quot; /&gt; 12
                          &lt;/div&gt;
                        &lt;/div&gt;
                      &lt;/div&gt;
                    &lt;/div&gt;
                  &lt;/div&gt;
                ))}
             &lt;/div&gt;
          ) : (
             /* [修正] 空狀態顯示區塊 - 獨立出來，不使用 columns 樣式 */
             &lt;div className=&quot;flex flex-col items-center justify-center py-20 gap-4 text-center&quot;&gt;
                &lt;p className=&quot;text-lg font-bold text-[#756256]&quot;&gt;找不到符合的書籍&lt;/p&gt;
                &lt;button 
                  onClick={handleResetHome}
                  className=&quot;flex items-center gap-2 px-6 py-2 bg-[#756256] text-white rounded-full font-bold shadow-md hover:bg-[#5D4E44] transition-all&quot;
                &gt;
                  &lt;RotateCcw size={16} /&gt; 返回上一頁
                &lt;/button&gt;
             &lt;/div&gt;
          )}
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};

// --- [修改] 個人資料頁 (ProfilePage) ---
// 增加 initialTab 接收
const ProfilePage = ({ onBack, user, onLogout, coins, myAvatars, currentAvatarId, onPurchase, onEquip, initialTab }) =&gt; {
  const [tab, setTab] = useState(&#x27;shelf&#x27;); 
  const [myListings, setMyListings] = useState(INITIAL_MY_LISTINGS);
  const [sellForm, setSellForm] = useState({
    title: &quot;&quot;, author: &quot;&quot;, price: &quot;&quot;, conditionLevel: &quot;九成新&quot;, images: []
  });

  // [新增] 購買確認 Modal 的狀態
  const [purchaseModalOpen, setPurchaseModalOpen] = useState(false);
  const [selectedAvatarToBuy, setSelectedAvatarToBuy] = useState(null);

  // [修改] 根據 initialTab 設定初始分頁
  useEffect(() =&gt; {
      if (initialTab) {
          setTab(initialTab);
      }
  }, [initialTab]);

  const handleUpload = () =&gt; {
    alert(&quot;上架成功！(模擬)&quot;);
    const newItem = {
        id: Date.now(),
        title: sellForm.title || &quot;未命名書籍&quot;,
        price: sellForm.price || 0,
        type: &#x27;sell&#x27;,
        status: &#x27;active&#x27;,
        date: new Date().toLocaleDateString(),
        views: 0,
        cover: &quot;https://im1.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/086/56/0010865620.jpg&amp;v=5f2a7a5dk&amp;w=348&amp;h=348&quot;
    };
    setMyListings([newItem, ...myListings]);
    setTab(&#x27;shelf&#x27;);
    setSellForm({ title: &quot;&quot;, author: &quot;&quot;, price: &quot;&quot;, conditionLevel: &quot;九成新&quot;, images: [] });
  };

  // 處理點擊購買按鈕 -&gt; 開啟 Modal
  const handleBuyClick = (avatar) =&gt; {
      setSelectedAvatarToBuy(avatar);
      setPurchaseModalOpen(true);
  };

  // 確認購買 -&gt; 執行交易 -&gt; 關閉 Modal
  const handleConfirmPurchase = () =&gt; {
      if (selectedAvatarToBuy) {
          onPurchase(selectedAvatarToBuy.id, selectedAvatarToBuy.price);
          setPurchaseModalOpen(false);
          setSelectedAvatarToBuy(null);
      }
  };

  const currentAvatar = AVATAR_LIST.find(a =&gt; a.id === currentAvatarId) || AVATAR_LIST[0];

  // Helper to filter avatars
  // [修改] 將已擁有的頭像集中到 myCollection
  const myCollection = AVATAR_LIST.filter(a =&gt; myAvatars.includes(a.id));
  
  // Logic to separate &quot;Special&quot; (Animal photos) from &quot;Standard&quot; (Illustrations)
  const specialAvatars = AVATAR_LIST.filter(a =&gt; a.id.startsWith(&#x27;special&#x27;) &amp;&amp; !myAvatars.includes(a.id));
  const standardAvatars = AVATAR_LIST.filter(a =&gt; !a.id.startsWith(&#x27;special&#x27;) &amp;&amp; a.id !== &#x27;default&#x27; &amp;&amp; !myAvatars.includes(a.id));

  // Helper component for avatar row
  const AvatarSection = ({ title, avatars, isOwnedSection }) =&gt; {
      if (avatars.length === 0) return null; // 如果該系列都買光了，就不顯示

      return (
        &lt;div className=&quot;mb-6&quot;&gt;
            &lt;h4 className=&quot;font-bold text-[#756256] mb-3 flex items-center gap-2&quot;&gt;
                &lt;span className=&quot;w-1 h-4 bg-[#A58976] rounded-full&quot;&gt;&lt;/span&gt;
                {title}
            &lt;/h4&gt;
            {/* [修改] 增加 justify-center 當數量少於等於3時 */}
            &lt;div className={`flex gap-4 overflow-x-auto pb-4 no-scrollbar ${avatars.length &lt;= 3 ? &#x27;justify-center&#x27; : &#x27;&#x27;}`}&gt;
                {avatars.map(avatar =&gt; {
                    const isEquipped = currentAvatarId === avatar.id;
                    const canAfford = coins &gt;= avatar.price;

                    return (
                        &lt;div key={avatar.id} className={`min-w-[100px] w-[100px] border rounded-xl p-3 flex flex-col items-center relative transition-all ${isEquipped ? &#x27;ring-2 ring-[#A58976] bg-[#F9F7F5]&#x27; : &#x27;hover:border-[#A58976] bg-white&#x27;}`} style={{ borderColor: COLORS.whiteBucks }}&gt;
                            {isEquipped &amp;&amp; &lt;div className=&quot;absolute top-1 right-1 text-green-500&quot;&gt;&lt;CheckCircle size={14} fill=&quot;currentColor&quot; className=&quot;text-white&quot;/&gt;&lt;/div&gt;}
                            
                            {/* [修改] padding 改為 p-1.5 讓圖片內縮 */}
                            &lt;div className=&quot;w-14 h-14 rounded-full overflow-hidden mb-2 bg-white border border-gray-200 shadow-sm p-1.5&quot;&gt;
                                &lt;img src={avatar.src} alt={avatar.name} className=&quot;w-full h-full object-cover rounded-full&quot; /&gt;
                            &lt;/div&gt;
                            &lt;div className=&quot;font-bold text-xs text-[#5D4037] mb-2 text-center line-clamp-1&quot;&gt;{avatar.name}&lt;/div&gt;
                            
                            {isOwnedSection ? (
                                &lt;button 
                                  onClick={() =&gt; onEquip(avatar.id)}
                                  disabled={isEquipped}
                                  className={`w-full py-1 text-[10px] rounded-full font-bold ${isEquipped ? &#x27;text-gray-400 cursor-default bg-gray-100&#x27; : &#x27;bg-[#756256] text-white hover:bg-[#5D4E44]&#x27;}`}
                                &gt;
                                    {isEquipped ? &#x27;使用中&#x27; : &#x27;更換&#x27;}
                                &lt;/button&gt;
                            ) : (
                                &lt;button 
                                  onClick={() =&gt; handleBuyClick(avatar)}
                                  disabled={!canAfford}
                                  className={`w-full py-1 text-[10px] rounded-full font-bold flex items-center justify-center gap-1 ${canAfford ? &#x27;bg-yellow-500 text-white hover:bg-yellow-600&#x27; : &#x27;bg-gray-100 text-gray-300 cursor-not-allowed&#x27;}`}
                                &gt;
                                    &lt;Coins size={8} /&gt; {avatar.price}
                                &lt;/button&gt;
                            )}
                        &lt;/div&gt;
                    );
                })}
            &lt;/div&gt;
        &lt;/div&gt;
      );
  };

  return (
    &lt;div className=&quot;min-h-screen pb-20&quot; style={{ ...fontStyle, backgroundColor: COLORS.bgLight, color: COLORS.brownWindmill }}&gt;
      &lt;nav className=&quot;backdrop-blur-md shadow-sm border-b sticky top-0 z-50&quot; style={{ backgroundColor: &#x27;rgba(255,255,255,0.8)&#x27;, borderColor: COLORS.whiteBucks }}&gt;
        &lt;div className=&quot;max-w-6xl mx-auto px-4 h-16 flex items-center justify-between&quot;&gt;
          &lt;div className=&quot;flex items-center gap-3&quot;&gt;&lt;button onClick={onBack} className=&quot;p-2 rounded-full hover:bg-gray-100&quot;&gt;&lt;ArrowRight size={20} className=&quot;rotate-180 text-[#9E9081]&quot; /&gt;&lt;/button&gt;&lt;div className=&quot;font-bold text-lg tracking-wide&quot;&gt;個人專區&lt;/div&gt;&lt;/div&gt;
          &lt;button onClick={onLogout} className=&quot;flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-red-50 text-red-700 border border-red-200&quot;&gt;&lt;LogOut size={14} /&gt; 登出&lt;/button&gt;
        &lt;/div&gt;
      &lt;/nav&gt;

      &lt;main className=&quot;max-w-2xl mx-auto px-4 py-8 space-y-8&quot;&gt;
        {/* Profile Header &amp; Avatar Editor */}
        &lt;div className=&quot;flex flex-col items-center&quot;&gt;
          &lt;div className=&quot;relative group cursor-pointer&quot; onClick={() =&gt; setTab(&#x27;store&#x27;)}&gt;
            {/* [修改] 增加個人頁面大頭貼的內縮邊框 */}
            &lt;div className=&quot;w-24 h-24 rounded-full border-4 shadow-md overflow-hidden bg-white p-1&quot; style={{ borderColor: COLORS.bgLight }}&gt;
               &lt;img src={currentAvatar.src} className=&quot;w-full h-full object-cover rounded-full&quot; alt=&quot;User&quot; /&gt;
            &lt;/div&gt;
            &lt;div className=&quot;absolute bottom-0 right-0 text-white p-1.5 rounded-full border-2 border-white shadow-sm flex items-center justify-center&quot; style={{ backgroundColor: COLORS.chocolateBubble, width: 28, height: 28 }}&gt;
              &lt;Palette size={14} /&gt;
            &lt;/div&gt;
          &lt;/div&gt;
          &lt;h2 className=&quot;mt-4 text-xl font-bold tracking-widest&quot; style={{ color: COLORS.brownWindmill }}&gt;{user?.name}&lt;/h2&gt;
          &lt;p className=&quot;text-sm text-[#9E9081] mb-2&quot;&gt;{user?.grade} {user?.class}班 · {user?.email}&lt;/p&gt;
          
          &lt;div className=&quot;flex items-center gap-1 bg-yellow-100 px-3 py-1 rounded-full text-xs font-bold text-yellow-700&quot;&gt;
             &lt;Coins size={14} fill=&quot;currentColor&quot; /&gt; {coins} 書香幣
          &lt;/div&gt;
        &lt;/div&gt;

        {/* Tabs */}
        &lt;div className=&quot;flex border rounded-lg overflow-hidden bg-white p-1&quot; style={{ borderColor: COLORS.whiteBucks }}&gt;
            &lt;button onClick={() =&gt; setTab(&#x27;shelf&#x27;)} className={`flex-1 py-2 text-sm font-bold rounded-md transition-colors ${tab === &#x27;shelf&#x27; ? &#x27;bg-[#F9F7F5] text-[#756256]&#x27; : &#x27;text-gray-400 hover:text-gray-600&#x27;}`}&gt;我的書櫃&lt;/button&gt;
            &lt;button onClick={() =&gt; setTab(&#x27;upload&#x27;)} className={`flex-1 py-2 text-sm font-bold rounded-md transition-colors ${tab === &#x27;upload&#x27; ? &#x27;bg-[#F9F7F5] text-[#756256]&#x27; : &#x27;text-gray-400 hover:text-gray-600&#x27;}`}&gt;上架書籍&lt;/button&gt;
            &lt;button onClick={() =&gt; setTab(&#x27;store&#x27;)} className={`flex-1 py-2 text-sm font-bold rounded-md transition-colors ${tab === &#x27;store&#x27; ? &#x27;bg-[#F9F7F5] text-[#756256]&#x27; : &#x27;text-gray-400 hover:text-gray-600&#x27;}`}&gt;頭像商店&lt;/button&gt;
        &lt;/div&gt;

        {/* Content */}
        {tab === &#x27;upload&#x27; ? (
            &lt;div className=&quot;bg-white rounded-xl shadow-sm border p-6 space-y-4 animate-fade-in&quot; style={{ borderColor: COLORS.whiteBucks }}&gt;
                &lt;div className=&quot;text-center p-6 border-2 border-dashed rounded-lg bg-[#F9F7F5] cursor-pointer&quot; style={{ borderColor: COLORS.fossilGray }}&gt;
                    &lt;ImageIcon className=&quot;mx-auto text-[#9E9081] mb-2&quot; /&gt;
                    &lt;span className=&quot;text-sm text-[#756256]&quot;&gt;點擊上傳封面照片&lt;/span&gt;
                &lt;/div&gt;
                &lt;div&gt;
                    &lt;label className=&quot;block text-xs font-bold text-[#9E9081] mb-1&quot;&gt;書籍名稱&lt;/label&gt;
                    &lt;input type=&quot;text&quot; value={sellForm.title} onChange={e =&gt; setSellForm({...sellForm, title: e.target.value})} className=&quot;w-full p-2 border rounded-lg bg-gray-50 text-sm&quot; placeholder=&quot;例如：龍騰高一英文&quot; /&gt;
                &lt;/div&gt;
                &lt;div className=&quot;grid grid-cols-2 gap-4&quot;&gt;
                    &lt;div&gt;
                        &lt;label className=&quot;block text-xs font-bold text-[#9E9081] mb-1&quot;&gt;售價 (NT$)&lt;/label&gt;
                        &lt;input type=&quot;number&quot; value={sellForm.price} onChange={e =&gt; setSellForm({...sellForm, price: e.target.value})} className=&quot;w-full p-2 border rounded-lg bg-gray-50 text-sm&quot; placeholder=&quot;100&quot; /&gt;
                    &lt;/div&gt;
                     &lt;div&gt;
                        &lt;label className=&quot;block text-xs font-bold text-[#9E9081] mb-1&quot;&gt;書況&lt;/label&gt;
                        &lt;select value={sellForm.conditionLevel} onChange={e =&gt; setSellForm({...sellForm, conditionLevel: e.target.value})} className=&quot;w-full p-2 border rounded-lg bg-gray-50 text-sm&quot;&gt;
                            {CONDITION_LEVELS.map(l =&gt; &lt;option key={l} value={l}&gt;{l}&lt;/option&gt;)}
                        &lt;/select&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;button onClick={handleUpload} className=&quot;w-full py-3 bg-[#756256] text-white rounded-xl font-bold shadow-md hover:bg-[#5D4E44] transition-colors&quot;&gt;
                    確認上架
                &lt;/button&gt;
            &lt;/div&gt;
        ) : tab === &#x27;store&#x27; ? (
             &lt;div className=&quot;bg-white rounded-xl shadow-sm border p-4 animate-fade-in&quot; style={{ borderColor: COLORS.whiteBucks }}&gt;
                 &lt;div className=&quot;flex items-center justify-between mb-4&quot;&gt;
                     &lt;h3 className=&quot;font-bold text-[#756256] flex items-center gap-2&quot;&gt;&lt;Store size={20} /&gt; 頭像交易所&lt;/h3&gt;
                     &lt;span className=&quot;text-xs text-[#9E9081]&quot;&gt;預設圖片之後可更換&lt;/span&gt;
                 &lt;/div&gt;
                 
                 {/* [修改] 分區顯示：將已擁有的獨立顯示 */}
                 &lt;AvatarSection title=&quot;我的頭像 (已擁有)&quot; avatars={myCollection} isOwnedSection={true} /&gt;
                 &lt;AvatarSection title=&quot;限定收藏 (100 代幣)&quot; avatars={specialAvatars} isOwnedSection={false} /&gt;
                 &lt;AvatarSection title=&quot;經典系列 (100 代幣)&quot; avatars={standardAvatars} isOwnedSection={false} /&gt;
                 
             &lt;/div&gt;
        ) : (
            &lt;div className=&quot;space-y-4 animate-fade-in&quot;&gt;
                {myListings.length === 0 ? (
                    &lt;div className=&quot;text-center py-10 text-gray-400&quot;&gt;目前沒有上架的書籍&lt;/div&gt;
                ) : (
                    myListings.map(item =&gt; (
                        &lt;div key={item.id} className=&quot;bg-white rounded-xl shadow-sm border p-3 flex gap-4 items-center&quot; style={{ borderColor: COLORS.whiteBucks }}&gt;
                            &lt;div className=&quot;w-16 h-20 bg-gray-200 rounded flex-shrink-0 overflow-hidden&quot;&gt;
                                &lt;img src={item.cover} className=&quot;w-full h-full object-cover&quot; alt={item.title}/&gt;
                            &lt;/div&gt;
                            &lt;div className=&quot;flex-1 min-w-0&quot;&gt;
                                &lt;h3 className=&quot;font-bold text-[#756256] truncate&quot;&gt;{item.title}&lt;/h3&gt;
                                &lt;div className=&quot;text-sm text-[#9E9081] font-medium&quot;&gt;NT$ {item.price}&lt;/div&gt;
                                &lt;div className=&quot;text-xs text-gray-400 mt-1 flex items-center gap-2&quot;&gt;
                                    &lt;span&gt;{item.views} 次瀏覽&lt;/span&gt; · &lt;span&gt;{item.date}&lt;/span&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;
                            &lt;button onClick={() =&gt; setMyListings(myListings.filter(i =&gt; i.id !== item.id))} className=&quot;p-2 text-red-400 hover:bg-red-50 rounded-full&quot;&gt;
                                &lt;Trash2 size={18} /&gt;
                            &lt;/button&gt;
                        &lt;/div&gt;
                    ))
                )}
            &lt;/div&gt;
        )}
      &lt;/main&gt;

      {/* [新增] 購買確認 Modal */}
      {purchaseModalOpen &amp;&amp; selectedAvatarToBuy &amp;&amp; (
          &lt;div className=&quot;fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fade-in&quot;&gt;
              &lt;div className=&quot;bg-white w-full max-w-sm rounded-2xl p-6 shadow-2xl animate-scale-up text-center relative overflow-hidden&quot;&gt;
                  &lt;div className=&quot;absolute top-0 left-0 w-full h-2 bg-yellow-400&quot;&gt;&lt;/div&gt;
                  
                  &lt;div className=&quot;w-24 h-24 rounded-full bg-gray-100 mx-auto mb-4 border-4 border-yellow-100 overflow-hidden p-1.5 shadow-inner&quot;&gt;
                      &lt;img src={selectedAvatarToBuy.src} alt=&quot;avatar&quot; className=&quot;w-full h-full object-cover rounded-full&quot; /&gt;
                  &lt;/div&gt;
                  
                  &lt;h3 className=&quot;text-xl font-bold text-[#5D4037] mb-2&quot;&gt;確認購買&lt;/h3&gt;
                  &lt;p className=&quot;text-sm text-gray-500 mb-6&quot;&gt;
                      您確定要花費 &lt;span className=&quot;font-bold text-yellow-600&quot;&gt;{selectedAvatarToBuy.price} 書香幣&lt;/span&gt;&lt;br/&gt;
                      購買 &lt;span className=&quot;font-bold text-[#756256]&quot;&gt;「{selectedAvatarToBuy.name}」&lt;/span&gt; 嗎？
                  &lt;/p&gt;
                  
                  &lt;div className=&quot;flex gap-3&quot;&gt;
                      &lt;button 
                          onClick={() =&gt; setPurchaseModalOpen(false)}
                          className=&quot;flex-1 py-2.5 rounded-xl border border-gray-200 text-gray-500 font-bold hover:bg-gray-50 transition-colors&quot;
                      &gt;
                          再想想
                      &lt;/button&gt;
                      &lt;button 
                          onClick={handleConfirmPurchase}
                          className=&quot;flex-1 py-2.5 rounded-xl bg-yellow-500 text-white font-bold shadow-md hover:bg-yellow-600 transition-colors&quot;
                      &gt;
                          確認購買
                      &lt;/button&gt;
                  &lt;/div&gt;
              &lt;/div&gt;
          &lt;/div&gt;
      )}
    &lt;/div&gt;
  );
};

// --- [修改] 主應用程式 App ---
// 狀態提升：在這裡管理 Wishes, Notifications
const App = () =&gt; {
  const [currentPage, setCurrentPage] = useState(&#x27;login&#x27;); 
  const [currentUser, setCurrentUser] = useState(null);
  const [selectedProduct, setSelectedProduct] = useState(null);
  const [profileInitialTab, setProfileInitialTab] = useState(null); // [新增] 控制 Profile 初始分頁
  
  // 全局狀態：書香幣 &amp; 頭像 &amp; 許願列表
  const [coins, setCoins] = useState(120);
  const [isCheckedIn, setIsCheckedIn] = useState(false);
  const [myAvatars, setMyAvatars] = useState([&#x27;default&#x27;]); 
  const [currentAvatarId, setCurrentAvatarId] = useState(&#x27;default&#x27;);
  const [wishes, setWishes] = useState(INITIAL_WISHES);

  // [修改] 通知狀態管理
  const [notifications, setNotifications] = useState(INITIAL_NOTIFICATIONS);
  // 計算未讀數量
  const unreadCount = notifications.filter(n =&gt; !n.isRead).length;

  // 處理閱讀通知
  const handleReadNotification = (id) =&gt; {
      setNotifications(prev =&gt; prev.map(n =&gt; n.id === id ? { ...n, isRead: true } : n));
  };

  // 簽到邏輯
  const handleCheckIn = () =&gt; {
    if (!isCheckedIn) {
      setIsCheckedIn(true);
      setCoins(prev =&gt; prev + 5);
    }
  };

  // [新增] 跳轉到商店邏輯
  const handleNavigateToStore = () =&gt; {
      setProfileInitialTab(&#x27;store&#x27;);
      setCurrentPage(&#x27;profile&#x27;);
  };

  // [修改] 購買頭像邏輯 - 移除 window.confirm，只保留邏輯
  const handlePurchaseAvatar = (avatarId, price) =&gt; {
      if (coins &gt;= price &amp;&amp; !myAvatars.includes(avatarId)) {
          setCoins(prev =&gt; prev - price);
          setMyAvatars(prev =&gt; [...prev, avatarId]);
          setCurrentAvatarId(avatarId); // 購買後直接換上
      }
  };

  // 更換頭像邏輯
  const handleEquipAvatar = (avatarId) =&gt; {
      setCurrentAvatarId(avatarId);
  };

  // 新增許願邏輯
  const handleAddWish = (content) =&gt; {
    const newWish = {
      id: Date.now(),
      content: content,
      user: currentUser?.name || &quot;神秘同學&quot;,
      time: &quot;剛剛&quot;
    };
    setWishes([newWish, ...wishes]);
  };

  // 路由切換
  const navigate = (page, data = null) =&gt; {
    if (page === &#x27;product&#x27; &amp;&amp; data) {
        setSelectedProduct(data);
    }
    // 一般切換頁面時，清除 Profile 的初始 tab 設定，避免下次進入卡住
    if (page !== &#x27;profile&#x27;) {
        setProfileInitialTab(null);
    }
    setCurrentPage(page);
  };

  const handleLogin = (userProfile) =&gt; {
    setCurrentUser(userProfile);
    setCurrentPage(&#x27;home&#x27;);
  };

  const handleLogout = () =&gt; {
    setCurrentUser(null);
    setCurrentPage(&#x27;login&#x27;);
  };

  switch (currentPage) {
    case &#x27;login&#x27;:
        return &lt;LoginPage onLogin={handleLogin} /&gt;;
    case &#x27;profile&#x27;:
        return (
            &lt;ProfilePage 
                user={currentUser} 
                onBack={() =&gt; navigate(&#x27;home&#x27;)} 
                onLogout={handleLogout}
                coins={coins}
                myAvatars={myAvatars}
                currentAvatarId={currentAvatarId}
                onPurchase={handlePurchaseAvatar}
                onEquip={handleEquipAvatar}
                initialTab={profileInitialTab} // [新增]
            /&gt;
        );
    case &#x27;product&#x27;:
        return &lt;ProductDetailPage product={selectedProduct} onBack={() =&gt; navigate(&#x27;home&#x27;)} onContact={() =&gt; alert(`已向 ${selectedProduct.seller.name} 發送訊息！`)} /&gt;;
    case &#x27;home&#x27;:
    default:
        return (
            &lt;HomePage 
                onNavigate={navigate} 
                user={currentUser} 
                unreadCount={unreadCount} 
                currentAvatarId={currentAvatarId}
                coins={coins}
                isCheckedIn={isCheckedIn}
                onCheckIn={handleCheckIn}
                onGoToStore={handleNavigateToStore} // [新增]
                wishes={wishes}
                onAddWish={handleAddWish}
                notifications={notifications}
                onReadNotification={handleReadNotification}
            /&gt;
        );
  }
};

export default App;</code></pre>
      </div>
    </div>
  </article><span class="sans" style="font-size:14px;padding-top:2em"></span>
</body>

</html>